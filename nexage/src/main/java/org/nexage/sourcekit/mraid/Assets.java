package org.nexage.sourcekit.mraid;

class Assets {

	/*
	 * To add a new assets, convert the asset (js or jpg or png) to a base64 string, use an online tool to remove the
	 * new line characters, then add the string here.
	 */
    // Debug log DISABLED
    public static final String mraidJS = "Ly8KLy8gIG1yYWlkLmpzCi8vCgooZnVuY3Rpb24oKSB7CgogIGNvbnNvbGUubG9nKCJNUkFJRCBvYmplY3QgbG9hZGluZy4uLiIpOwoKICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICogY29uc29sZSBsb2dnaW5nIGhlbHBlcgogICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCiAgdmFyIExvZ0xldmVsRW51bSA9IHsKICAgICJERUJVRyIgICA6IDAsCiAgICAiSU5GTyIgICAgOiAxLAogICAgIldBUk5JTkciIDogMiwKICAgICJFUlJPUiIgICA6IDMsCiAgICAiTk9ORSIgICAgOiA0CiAgfTsKCiAgdmFyIGxvZ0xldmVsID0gTG9nTGV2ZWxFbnVtLklORk87CiAgdmFyIGxvZyA9IHt9OwoKICBsb2cuZCA9IGZ1bmN0aW9uKG1zZykgewogICAgaWYgKGxvZ0xldmVsIDw9IExvZ0xldmVsRW51bS5ERUJVRykgewogICAgICBjb25zb2xlLmxvZygiKEQtbXJhaWQuanMpICIgKyBtc2cpOwogICAgfQogIH07CgogIGxvZy5pID0gZnVuY3Rpb24obXNnKSB7CiAgICBpZiAobG9nTGV2ZWwgPD0gTG9nTGV2ZWxFbnVtLklORk8pIHsKICAgICAgY29uc29sZS5sb2coIihJLW1yYWlkLmpzKSAiICsgbXNnKTsKICAgIH0KICB9OwoKICBsb2cudyA9IGZ1bmN0aW9uKG1zZykgewogICAgaWYgKGxvZ0xldmVsIDw9IExvZ0xldmVsRW51bS5XQVJOSU5HKSB7CiAgICAgIGNvbnNvbGUubG9nKCIoVy1tcmFpZC5qcykgIiArIG1zZyk7CiAgICB9CiAgfTsKCiAgbG9nLmUgPSBmdW5jdGlvbihtc2cpIHsKICAgIGlmIChsb2dMZXZlbCA8PSBMb2dMZXZlbEVudW0uRVJST1IpIHsKICAgICAgY29uc29sZS5sb2coIihFLW1yYWlkLmpzKSAiICsgbXNnKTsKICAgIH0KICB9OwoKICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICogTVJBSUQgZGVjbGFyYXRpb24KICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgogIHZhciBtcmFpZCA9IHdpbmRvdy5tcmFpZCA9IHt9OwoKICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICogY29uc3RhbnRzCiAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKICB2YXIgVkVSU0lPTiA9ICIyLjAiOwoKICB2YXIgU1RBVEVTID0gbXJhaWQuU1RBVEVTID0gewogICAgIkxPQURJTkciIDogImxvYWRpbmciLAogICAgIkRFRkFVTFQiIDogImRlZmF1bHQiLAogICAgIkVYUEFOREVEIiA6ICJleHBhbmRlZCIsCiAgICAiUkVTSVpFRCIgOiAicmVzaXplZCIsCiAgICAiSElEREVOIiA6ICJoaWRkZW4iCiAgfTsKCiAgdmFyIFBMQUNFTUVOVF9UWVBFUyA9IG1yYWlkLlBMQUNFTUVOVF9UWVBFUyA9IHsKICAgICJJTkxJTkUiIDogImlubGluZSIsCiAgICAiSU5URVJTVElUSUFMIiA6ICJpbnRlcnN0aXRpYWwiCiAgfTsKCiAgdmFyIFJFU0laRV9QUk9QRVJUSUVTX0NVU1RPTV9DTE9TRV9QT1NJVElPTiA9IG1yYWlkLlJFU0laRV9QUk9QRVJUSUVTX0NVU1RPTV9DTE9TRV9QT1NJVElPTiA9IHsKICAgICJUT1BfTEVGVCIgOiAidG9wLWxlZnQiLAogICAgIlRPUF9DRU5URVIiIDogInRvcC1jZW50ZXIiLAogICAgIlRPUF9SSUdIVCIgOiAidG9wLXJpZ2h0IiwKICAgICJDRU5URVIiIDogImNlbnRlciIsCiAgICAiQk9UVE9NX0xFRlQiIDogImJvdHRvbS1sZWZ0IiwKICAgICJCT1RUT01fQ0VOVEVSIiA6ICJib3R0b20tY2VudGVyIiwKICAgICJCT1RUT01fUklHSFQiIDogImJvdHRvbS1yaWdodCIKICB9OwoKICB2YXIgT1JJRU5UQVRJT05fUFJPUEVSVElFU19GT1JDRV9PUklFTlRBVElPTiA9IG1yYWlkLk9SSUVOVEFUSU9OX1BST1BFUlRJRVNfRk9SQ0VfT1JJRU5UQVRJT04gPSB7CiAgICAiUE9SVFJBSVQiIDogInBvcnRyYWl0IiwKICAgICJMQU5EU0NBUEUiIDogImxhbmRzY2FwZSIsCiAgICAiTk9ORSIgOiAibm9uZSIKICB9OwoKICB2YXIgRVZFTlRTID0gbXJhaWQuRVZFTlRTID0gewogICAgIkVSUk9SIiA6ICJlcnJvciIsCiAgICAiUkVBRFkiIDogInJlYWR5IiwKICAgICJTSVpFQ0hBTkdFIiA6ICJzaXplQ2hhbmdlIiwKICAgICJTVEFURUNIQU5HRSIgOiAic3RhdGVDaGFuZ2UiLAogICAgIlZJRVdBQkxFQ0hBTkdFIiA6ICJ2aWV3YWJsZUNoYW5nZSIKICB9OwoKICB2YXIgU1VQUE9SVEVEX0ZFQVRVUkVTID0gbXJhaWQuU1VQUE9SVEVEX0ZFQVRVUkVTID0gewogICAgIlNNUyIgOiAic21zIiwKICAgICJURUwiIDogInRlbCIsCiAgICAiQ0FMRU5EQVIiIDogImNhbGVuZGFyIiwKICAgICJTVE9SRVBJQ1RVUkUiIDogInN0b3JlUGljdHVyZSIsCiAgICAiSU5MSU5FVklERU8iIDogImlubGluZVZpZGVvIgogIH07CgogIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgKiBzdGF0ZQogICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCiAgdmFyIHN0YXRlID0gU1RBVEVTLkxPQURJTkc7CiAgdmFyIHBsYWNlbWVudFR5cGUgPSBQTEFDRU1FTlRfVFlQRVMuSU5MSU5FOwogIHZhciBzdXBwb3J0ZWRGZWF0dXJlcyA9IHt9OwogIHZhciBpc1ZpZXdhYmxlID0gZmFsc2U7CiAgdmFyIGlzRXhwYW5kUHJvcGVydGllc1NldCA9IGZhbHNlOwogIHZhciBpc1Jlc2l6ZVJlYWR5ID0gZmFsc2U7CgogIHZhciBleHBhbmRQcm9wZXJ0aWVzID0gewogICAgIndpZHRoIiA6IDAsCiAgICAiaGVpZ2h0IiA6IDAsCiAgICAidXNlQ3VzdG9tQ2xvc2UiIDogZmFsc2UsCiAgICAiaXNNb2RhbCIgOiB0cnVlCiAgfTsKCiAgdmFyIG9yaWVudGF0aW9uUHJvcGVydGllcyA9IHsKICAgICJhbGxvd09yaWVudGF0aW9uQ2hhbmdlIiA6IHRydWUsCiAgICAiZm9yY2VPcmllbnRhdGlvbiIgOiBPUklFTlRBVElPTl9QUk9QRVJUSUVTX0ZPUkNFX09SSUVOVEFUSU9OLk5PTkUKICB9OwoKICB2YXIgcmVzaXplUHJvcGVydGllcyA9IHsKICAgICJ3aWR0aCIgOiAwLAogICAgImhlaWdodCIgOiAwLAogICAgImN1c3RvbUNsb3NlUG9zaXRpb24iIDogUkVTSVpFX1BST1BFUlRJRVNfQ1VTVE9NX0NMT1NFX1BPU0lUSU9OLlRPUF9SSUdIVCwKICAgICJvZmZzZXRYIiA6IDAsCiAgICAib2Zmc2V0WSIgOiAwLAogICAgImFsbG93T2Zmc2NyZWVuIiA6IHRydWUKICB9OwoKICB2YXIgY3VycmVudFBvc2l0aW9uID0gewogICAgIngiIDogMCwKICAgICJ5IiA6IDAsCiAgICAid2lkdGgiIDogMCwKICAgICJoZWlnaHQiIDogMAogIH07CgogIHZhciBkZWZhdWx0UG9zaXRpb24gPSB7CiAgICAieCIgOiAwLAogICAgInkiIDogMCwKICAgICJ3aWR0aCIgOiAwLAogICAgImhlaWdodCIgOiAwCiAgfTsKCiAgdmFyIG1heFNpemUgPSB7CiAgICAid2lkdGgiIDogMCwKICAgICJoZWlnaHQiIDogMAogIH07CgogIHZhciBzY3JlZW5TaXplID0gewogICAgIndpZHRoIiA6IDAsCiAgICAiaGVpZ2h0IiA6IDAKICB9OwoKICB2YXIgY3VycmVudE9yaWVudGF0aW9uID0gMDsKCiAgdmFyIGxpc3RlbmVycyA9IHt9OwoKICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICogIm9mZmljaWFsIiBBUEk6IG1ldGhvZHMgY2FsbGVkIGJ5IGNyZWF0aXZlCiAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKICBtcmFpZC5hZGRFdmVudExpc3RlbmVyID0gZnVuY3Rpb24oZXZlbnQsIGxpc3RlbmVyKSB7CiAgICBsb2cuaSgibXJhaWQuYWRkRXZlbnRMaXN0ZW5lciAiICsgZXZlbnQgKyAiOiAiICsgU3RyaW5nKGxpc3RlbmVyKSk7CiAgICBpZiAoIWV2ZW50IHx8ICFsaXN0ZW5lcikgewogICAgICBtcmFpZC5maXJlRXJyb3JFdmVudCgiQm90aCBldmVudCBhbmQgbGlzdGVuZXIgYXJlIHJlcXVpcmVkLiIsICJhZGRFdmVudExpc3RlbmVyIik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICghY29udGFpbnMoZXZlbnQsIEVWRU5UUykpIHsKICAgICAgbXJhaWQuZmlyZUVycm9yRXZlbnQoIlVua25vd24gTVJBSUQgZXZlbnQ6ICIgKyBldmVudCwgImFkZEV2ZW50TGlzdGVuZXIiKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgdmFyIGxpc3RlbmVyc0ZvckV2ZW50ID0gbGlzdGVuZXJzW2V2ZW50XSA9IGxpc3RlbmVyc1tldmVudF0gfHwgW107CiAgICAvLyBjaGVjayB0byBtYWtlIHN1cmUgdGhhdCB0aGUgbGlzdGVuZXIgaXNuJ3QgYWxyZWFkeSByZWdpc3RlcmVkCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3RlbmVyc0ZvckV2ZW50Lmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBzdHIxID0gU3RyaW5nKGxpc3RlbmVyKTsKICAgICAgdmFyIHN0cjIgPSBTdHJpbmcobGlzdGVuZXJzRm9yRXZlbnRbaV0pOwogICAgICBpZiAobGlzdGVuZXIgPT09IGxpc3RlbmVyc0ZvckV2ZW50W2ldIHx8IHN0cjEgPT09IHN0cjIpIHsKICAgICAgICBsb2cuaSgibGlzdGVuZXIgIiArIHN0cjEgKyAiIGlzIGFscmVhZHkgcmVnaXN0ZXJlZCBmb3IgZXZlbnQgIiArIGV2ZW50KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgIH0KICAgIGxpc3RlbmVyc0ZvckV2ZW50LnB1c2gobGlzdGVuZXIpOwogIH07CgogIG1yYWlkLmNyZWF0ZUNhbGVuZGFyRXZlbnQgPSBmdW5jdGlvbihwYXJhbWV0ZXJzKSB7CiAgICBsb2cuaSgibXJhaWQuY3JlYXRlQ2FsZW5kYXJFdmVudCB3aXRoICIgKyBwYXJhbWV0ZXJzKTsKICAgIGlmIChzdXBwb3J0ZWRGZWF0dXJlc1ttcmFpZC5TVVBQT1JURURfRkVBVFVSRVMuQ0FMRU5EQVJdKSB7CiAgICAgIGNhbGxOYXRpdmUoImNyZWF0ZUNhbGVuZGFyRXZlbnQ/ZXZlbnRKU09OPSIJKyBKU09OLnN0cmluZ2lmeShwYXJhbWV0ZXJzKSk7CiAgICB9IGVsc2UgewogICAgICBsb2cuZSgiY3JlYXRlQ2FsZW5kYXJFdmVudCBpcyBub3Qgc3VwcG9ydGVkIik7CiAgICB9CiAgfTsKCiAgbXJhaWQuY2xvc2UgPSBmdW5jdGlvbigpIHsKICAgIGxvZy5pKCJtcmFpZC5jbG9zZSIpOwogICAgaWYgKHN0YXRlID09PSBTVEFURVMuTE9BRElORwogICAgICAgIHx8IChzdGF0ZSA9PT0gU1RBVEVTLkRFRkFVTFQgJiYgcGxhY2VtZW50VHlwZSA9PT0gUExBQ0VNRU5UX1RZUEVTLklOTElORSkKICAgICAgICB8fCBzdGF0ZSA9PT0gU1RBVEVTLkhJRERFTikgewogICAgICAvLyBkbyBub3RoaW5nCiAgICAgIHJldHVybjsKICAgIH0KICAgIGNhbGxOYXRpdmUoImNsb3NlIik7CiAgfTsKCiAgbXJhaWQuZXhwYW5kID0gZnVuY3Rpb24odXJsKSB7CiAgICBpZiAodXJsID09PSB1bmRlZmluZWQpIHsKICAgICAgbG9nLmkoIm1yYWlkLmV4cGFuZCAoMS1wYXJ0KSIpOwogICAgfSBlbHNlIHsKICAgICAgbG9nLmkoIm1yYWlkLmV4cGFuZCAiICsgdXJsKTsKICAgIH0KICAgIC8vIFRoZSBvbmx5IHRpbWUgaXQgaXMgdmFsaWQgdG8gY2FsbCBleHBhbmQgaXMgd2hlbiB0aGUgYWQgaXMKICAgIC8vIGEgYmFubmVyIGN1cnJlbnRseSBpbiBlaXRoZXIgZGVmYXVsdCBvciByZXNpemVkIHN0YXRlLgogICAgaWYgKHBsYWNlbWVudFR5cGUgIT09IFBMQUNFTUVOVF9UWVBFUy5JTkxJTkUKICAgICAgICB8fCAoc3RhdGUgIT09IFNUQVRFUy5ERUZBVUxUICYmIHN0YXRlICE9PSBTVEFURVMuUkVTSVpFRCkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHVybCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIGNhbGxOYXRpdmUoImV4cGFuZCIpOwogICAgfSBlbHNlIHsKICAgICAgY2FsbE5hdGl2ZSgiZXhwYW5kP3VybD0iICsgZW5jb2RlVVJJQ29tcG9uZW50KHVybCkpOwogICAgfQogIH07CgogIG1yYWlkLmdldEN1cnJlbnRQb3NpdGlvbiA9IGZ1bmN0aW9uKCkgewogICAgbG9nLmkoIm1yYWlkLmdldEN1cnJlbnRQb3NpdGlvbiIpOwogICAgcmV0dXJuIGN1cnJlbnRQb3NpdGlvbjsKICB9OwoKICBtcmFpZC5nZXREZWZhdWx0UG9zaXRpb24gPSBmdW5jdGlvbigpIHsKICAgIGxvZy5pKCJtcmFpZC5nZXREZWZhdWx0UG9zaXRpb24iKTsKICAgIHJldHVybiBkZWZhdWx0UG9zaXRpb247CiAgfTsKCiAgbXJhaWQuZ2V0RXhwYW5kUHJvcGVydGllcyA9IGZ1bmN0aW9uKCkgewogICAgbG9nLmkoIm1yYWlkLmdldEV4cGFuZFByb3BlcnRpZXMiKTsKICAgIHJldHVybiBleHBhbmRQcm9wZXJ0aWVzOwogIH07CgogIG1yYWlkLmdldE1heFNpemUgPSBmdW5jdGlvbigpIHsKICAgIGxvZy5pKCJtcmFpZC5nZXRNYXhTaXplIik7CiAgICByZXR1cm4gbWF4U2l6ZTsKICB9OwoKICBtcmFpZC5nZXRPcmllbnRhdGlvblByb3BlcnRpZXMgPSBmdW5jdGlvbigpIHsKICAgIGxvZy5pKCJtcmFpZC5nZXRPcmllbnRhdGlvblByb3BlcnRpZXMiKTsKICAgIHJldHVybiBvcmllbnRhdGlvblByb3BlcnRpZXM7CiAgfTsKCiAgbXJhaWQuZ2V0UGxhY2VtZW50VHlwZSA9IGZ1bmN0aW9uKCkgewogICAgbG9nLmkoIm1yYWlkLmdldFBsYWNlbWVudFR5cGUiKTsKICAgIHJldHVybiBwbGFjZW1lbnRUeXBlOwogIH07CgogIG1yYWlkLmdldFJlc2l6ZVByb3BlcnRpZXMgPSBmdW5jdGlvbigpIHsKICAgIGxvZy5pKCJtcmFpZC5nZXRSZXNpemVQcm9wZXJ0aWVzIik7CiAgICByZXR1cm4gcmVzaXplUHJvcGVydGllczsKICB9OwoKICBtcmFpZC5nZXRTY3JlZW5TaXplID0gZnVuY3Rpb24oKSB7CiAgICBsb2cuaSgibXJhaWQuZ2V0U2NyZWVuU2l6ZSIpOwogICAgcmV0dXJuIHNjcmVlblNpemU7CiAgfTsKCiAgbXJhaWQuZ2V0U3RhdGUgPSBmdW5jdGlvbigpIHsKICAgIGxvZy5pKCJtcmFpZC5nZXRTdGF0ZSIpOwogICAgcmV0dXJuIHN0YXRlOwogIH07CgogIG1yYWlkLmdldFZlcnNpb24gPSBmdW5jdGlvbigpIHsKICAgIGxvZy5pKCJtcmFpZC5nZXRWZXJzaW9uIik7CiAgICByZXR1cm4gVkVSU0lPTjsKICB9OwoKICBtcmFpZC5pc1ZpZXdhYmxlID0gZnVuY3Rpb24oKSB7CiAgICBsb2cuaSgibXJhaWQuaXNWaWV3YWJsZSIpOwogICAgcmV0dXJuIGlzVmlld2FibGU7CiAgfTsKCiAgbXJhaWQub3BlbiA9IGZ1bmN0aW9uKHVybCkgewogICAgbG9nLmkoIm1yYWlkLm9wZW4gIiArIHVybCk7CiAgICBjYWxsTmF0aXZlKCJvcGVuP3VybD0iICsgZW5jb2RlVVJJQ29tcG9uZW50KHVybCkpOwogIH07CgogIG1yYWlkLnBsYXlWaWRlbyA9IGZ1bmN0aW9uKHVybCkgewogICAgbG9nLmkoIm1yYWlkLnBsYXlWaWRlbyAiICsgdXJsKTsKICAgIGNhbGxOYXRpdmUoInBsYXlWaWRlbz91cmw9IiArIGVuY29kZVVSSUNvbXBvbmVudCh1cmwpKTsKICB9OwoKICBtcmFpZC5yZW1vdmVFdmVudExpc3RlbmVyID0gZnVuY3Rpb24oZXZlbnQsIGxpc3RlbmVyKSB7CiAgICBsb2cuaSgibXJhaWQucmVtb3ZlRXZlbnRMaXN0ZW5lciAiICsgZXZlbnQgKyAiIDogIiArIFN0cmluZyhsaXN0ZW5lcikpOwogICAgaWYgKCFldmVudCkgewogICAgICBtcmFpZC5maXJlRXJyb3JFdmVudCgiRXZlbnQgaXMgcmVxdWlyZWQuIiwgInJlbW92ZUV2ZW50TGlzdGVuZXIiKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKCFjb250YWlucyhldmVudCwgRVZFTlRTKSkgewogICAgICBtcmFpZC5maXJlRXJyb3JFdmVudCgiVW5rbm93biBNUkFJRCBldmVudDogIiArIGV2ZW50LCAicmVtb3ZlRXZlbnRMaXN0ZW5lciIpOwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAobGlzdGVuZXJzLmhhc093blByb3BlcnR5KGV2ZW50KSkgewogICAgICBpZiAobGlzdGVuZXIpIHsKICAgICAgICB2YXIgbGlzdGVuZXJzRm9yRXZlbnQgPSBsaXN0ZW5lcnNbZXZlbnRdOwogICAgICAgIC8vIHRyeSB0byBmaW5kIHRoZSBnaXZlbiBsaXN0ZW5lcgogICAgICAgIHZhciBsZW4gPSBsaXN0ZW5lcnNGb3JFdmVudC5sZW5ndGg7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgdmFyIHJlZ2lzdGVyZWRMaXN0ZW5lciA9IGxpc3RlbmVyc0ZvckV2ZW50W2ldOwogICAgICAgICAgdmFyIHN0cjEgPSBTdHJpbmcobGlzdGVuZXIpOwogICAgICAgICAgdmFyIHN0cjIgPSBTdHJpbmcocmVnaXN0ZXJlZExpc3RlbmVyKTsKICAgICAgICAgIGlmIChsaXN0ZW5lciA9PT0gcmVnaXN0ZXJlZExpc3RlbmVyIHx8IHN0cjEgPT09IHN0cjIpIHsKICAgICAgICAgICAgbGlzdGVuZXJzRm9yRXZlbnQuc3BsaWNlKGksIDEpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGkgPT09IGxlbikgewogICAgICAgICAgbG9nLmkoImxpc3RlbmVyICIgKyBzdHIxICsgIiBub3QgZm91bmQgZm9yIGV2ZW50ICIgKyBldmVudCk7CiAgICAgICAgfQogICAgICAgIGlmIChsaXN0ZW5lcnNGb3JFdmVudC5sZW5ndGggPT09IDApIHsKICAgICAgICAgIGRlbGV0ZSBsaXN0ZW5lcnNbZXZlbnRdOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBubyBsaXN0ZW5lciB0byByZW1vdmUgd2FzIHByb3ZpZGVkLCBzbyByZW1vdmUgYWxsIGxpc3RlbmVycwogICAgICAgIC8vIGZvciBnaXZlbiBldmVudAogICAgICAgIGRlbGV0ZSBsaXN0ZW5lcnNbZXZlbnRdOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBsb2cuaSgibm8gbGlzdGVuZXJzIHJlZ2lzdGVyZWQgZm9yIGV2ZW50ICIgKyBldmVudCk7CiAgICB9CiAgfTsKCiAgbXJhaWQucmVzaXplID0gZnVuY3Rpb24oKSB7CiAgICBsb2cuaSgibXJhaWQucmVzaXplIik7CiAgICAvLyBUaGUgb25seSB0aW1lIGl0IGlzIHZhbGlkIHRvIGNhbGwgcmVzaXplIGlzIHdoZW4gdGhlIGFkIGlzCiAgICAvLyBhIGJhbm5lciBjdXJyZW50bHkgaW4gZWl0aGVyIGRlZmF1bHQgb3IgcmVzaXplZCBzdGF0ZS4KICAgIC8vIFRyaWdnZXIgYW4gZXJyb3IgaWYgdGhlIGN1cnJlbnQgc3RhdGUgaXMgZXhwYW5kZWQuCiAgICBpZiAocGxhY2VtZW50VHlwZSA9PT0gUExBQ0VNRU5UX1RZUEVTLklOVEVSU1RJVElBTCB8fCBzdGF0ZSA9PT0gU1RBVEVTLkxPQURJTkcgfHwgc3RhdGUgPT09IFNUQVRFUy5ISURERU4pIHsKICAgICAgLy8gZG8gbm90aGluZwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoc3RhdGUgPT09IFNUQVRFUy5FWFBBTkRFRCkgewogICAgICBtcmFpZC5maXJlRXJyb3JFdmVudCgibXJhaWQucmVzaXplIGNhbGxlZCB3aGVuIGFkIGlzIGluIGV4cGFuZGVkIHN0YXRlIiwgIm1yYWlkLnJlc2l6ZSIpOwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoIWlzUmVzaXplUmVhZHkpIHsKICAgICAgbXJhaWQuZmlyZUVycm9yRXZlbnQoIm1yYWlkLnJlc2l6ZSBpcyBub3QgcmVhZHkgdG8gYmUgY2FsbGVkIiwgIm1yYWlkLnJlc2l6ZSIpOwogICAgICByZXR1cm47CiAgICB9CiAgICBjYWxsTmF0aXZlKCJyZXNpemUiKTsKICB9OwoKICBtcmFpZC5zZXRFeHBhbmRQcm9wZXJ0aWVzID0gZnVuY3Rpb24ocHJvcGVydGllcykgewogICAgbG9nLmkoIm1yYWlkLnNldEV4cGFuZFByb3BlcnRpZXMiKTsKCiAgICBpZiAoIXZhbGlkYXRlKHByb3BlcnRpZXMsICJzZXRFeHBhbmRQcm9wZXJ0aWVzIikpIHsKICAgICAgbG9nLmUoImZhaWxlZCB2YWxpZGF0aW9uIik7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgb2xkVXNlQ3VzdG9tQ2xvc2UgPSBleHBhbmRQcm9wZXJ0aWVzLnVzZUN1c3RvbUNsb3NlOwoKICAgIC8vIGV4cGFuZFByb3BlcnRpZXMgY29udGFpbnMgMyByZWFkLXdyaXRlIHByb3BlcnRpZXM6IHdpZHRoLCBoZWlnaHQsIGFuZCB1c2VDdXN0b21DbG9zZTsKICAgIC8vIHRoZSBpc01vZGFsIHByb3BlcnR5IGlzIHJlYWQtb25seQogICAgdmFyIHJ3UHJvcHMgPSBbICJ3aWR0aCIsICJoZWlnaHQiLCAidXNlQ3VzdG9tQ2xvc2UiIF07CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJ3UHJvcHMubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIHByb3BuYW1lID0gcndQcm9wc1tpXTsKICAgICAgaWYgKHByb3BlcnRpZXMuaGFzT3duUHJvcGVydHkocHJvcG5hbWUpKSB7CiAgICAgICAgZXhwYW5kUHJvcGVydGllc1twcm9wbmFtZV0gPSBwcm9wZXJ0aWVzW3Byb3BuYW1lXTsKICAgICAgfQogICAgfQoKICAgIC8vIEluIE1SQUlEIHYyLjAsIGFsbCBleHBhbmRlZCBhZHMgYnkgZGVmaW5pdGlvbiBjb3ZlciB0aGUgZW50aXJlIHNjcmVlbiwKICAgIC8vIHNvIHRoZSBvbmx5IHByb3BlcnR5IHRoYXQgdGhlIG5hdGl2ZSBzaWRlIGhhcyB0byBrbm93IGFib3V0IGlzIHVzZUN1c3RvbUNsb3NlLgogICAgLy8gKFRoYXQgaXMsIHRoZSB3aWR0aCBhbmQgaGVpZ2h0IHByb3BlcnRpZXMgYXJlIG5vdCBuZWVkZWQgYnkgdGhlIG5hdGl2ZSBjb2RlLikKICAgIGlmIChleHBhbmRQcm9wZXJ0aWVzLnVzZUN1c3RvbUNsb3NlICE9PSBvbGRVc2VDdXN0b21DbG9zZSkgewogICAgICBjYWxsTmF0aXZlKCJ1c2VDdXN0b21DbG9zZT91c2VDdXN0b21DbG9zZT0iCSsgZXhwYW5kUHJvcGVydGllcy51c2VDdXN0b21DbG9zZSk7CiAgICB9CgogICAgaXNFeHBhbmRQcm9wZXJ0aWVzU2V0ID0gdHJ1ZTsKICB9OwoKICBtcmFpZC5zZXRPcmllbnRhdGlvblByb3BlcnRpZXMgPSBmdW5jdGlvbihwcm9wZXJ0aWVzKSB7CiAgICBsb2cuaSgibXJhaWQuc2V0T3JpZW50YXRpb25Qcm9wZXJ0aWVzIik7CgogICAgaWYgKCF2YWxpZGF0ZShwcm9wZXJ0aWVzLCAic2V0T3JpZW50YXRpb25Qcm9wZXJ0aWVzIikpIHsKICAgICAgbG9nLmUoImZhaWxlZCB2YWxpZGF0aW9uIik7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgbmV3T3JpZW50YXRpb25Qcm9wZXJ0aWVzID0ge307CiAgICBuZXdPcmllbnRhdGlvblByb3BlcnRpZXMuYWxsb3dPcmllbnRhdGlvbkNoYW5nZSA9IG9yaWVudGF0aW9uUHJvcGVydGllcy5hbGxvd09yaWVudGF0aW9uQ2hhbmdlLAogICAgICAgIG5ld09yaWVudGF0aW9uUHJvcGVydGllcy5mb3JjZU9yaWVudGF0aW9uID0gb3JpZW50YXRpb25Qcm9wZXJ0aWVzLmZvcmNlT3JpZW50YXRpb247CgogICAgLy8gb3JpZW50YXRpb25Qcm9wZXJ0aWVzIGNvbnRhaW5zIDIgcmVhZC13cml0ZSBwcm9wZXJ0aWVzOgogICAgLy8gYWxsb3dPcmllbnRhdGlvbkNoYW5nZSBhbmQgZm9yY2VPcmllbnRhdGlvbgogICAgdmFyIHJ3UHJvcHMgPSBbICJhbGxvd09yaWVudGF0aW9uQ2hhbmdlIiwgImZvcmNlT3JpZW50YXRpb24iIF07CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJ3UHJvcHMubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIHByb3BuYW1lID0gcndQcm9wc1tpXTsKICAgICAgaWYgKHByb3BlcnRpZXMuaGFzT3duUHJvcGVydHkocHJvcG5hbWUpKSB7CiAgICAgICAgbmV3T3JpZW50YXRpb25Qcm9wZXJ0aWVzW3Byb3BuYW1lXSA9IHByb3BlcnRpZXNbcHJvcG5hbWVdOwogICAgICB9CiAgICB9CgogICAgLy8gU2V0dGluZyBhbGxvd09yaWVudGF0aW9uQ2hhbmdlIHRvIHRydWUgd2hpbGUgc2V0dGluZyBmb3JjZU9yaWVudGF0aW9uCiAgICAvLyB0byBlaXRoZXIgcG9ydHJhaXQgb3IgbGFuZHNjYXBlCiAgICAvLyBpcyBjb25zaWRlcmVkIGFuIGVycm9yIGNvbmRpdGlvbi4KICAgIGlmIChuZXdPcmllbnRhdGlvblByb3BlcnRpZXMuYWxsb3dPcmllbnRhdGlvbkNoYW5nZQogICAgICAgICYmIG5ld09yaWVudGF0aW9uUHJvcGVydGllcy5mb3JjZU9yaWVudGF0aW9uICE9PSBtcmFpZC5PUklFTlRBVElPTl9QUk9QRVJUSUVTX0ZPUkNFX09SSUVOVEFUSU9OLk5PTkUpIHsKICAgICAgbXJhaWQuZmlyZUVycm9yRXZlbnQoCiAgICAgICAgICAiYWxsb3dPcmllbnRhdGlvbkNoYW5nZSBpcyB0cnVlIGJ1dCBmb3JjZU9yaWVudGF0aW9uIGlzICIKICAgICAgICAgICsgbmV3T3JpZW50YXRpb25Qcm9wZXJ0aWVzLmZvcmNlT3JpZW50YXRpb24sCiAgICAgICAgICAic2V0T3JpZW50YXRpb25Qcm9wZXJ0aWVzIik7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBvcmllbnRhdGlvblByb3BlcnRpZXMuYWxsb3dPcmllbnRhdGlvbkNoYW5nZSA9IG5ld09yaWVudGF0aW9uUHJvcGVydGllcy5hbGxvd09yaWVudGF0aW9uQ2hhbmdlOwogICAgb3JpZW50YXRpb25Qcm9wZXJ0aWVzLmZvcmNlT3JpZW50YXRpb24gPSBuZXdPcmllbnRhdGlvblByb3BlcnRpZXMuZm9yY2VPcmllbnRhdGlvbjsKCiAgICB2YXIgcGFyYW1zID0gImFsbG93T3JpZW50YXRpb25DaGFuZ2U9IgogICAgICAgICsgb3JpZW50YXRpb25Qcm9wZXJ0aWVzLmFsbG93T3JpZW50YXRpb25DaGFuZ2UKICAgICAgICArICImZm9yY2VPcmllbnRhdGlvbj0iICsgb3JpZW50YXRpb25Qcm9wZXJ0aWVzLmZvcmNlT3JpZW50YXRpb247CgogICAgY2FsbE5hdGl2ZSgic2V0T3JpZW50YXRpb25Qcm9wZXJ0aWVzPyIgKyBwYXJhbXMpOwogIH07CgogIG1yYWlkLnNldFJlc2l6ZVByb3BlcnRpZXMgPSBmdW5jdGlvbihwcm9wZXJ0aWVzKSB7CiAgICBsb2cuaSgibXJhaWQuc2V0UmVzaXplUHJvcGVydGllcyIpOwoKICAgIGlzUmVzaXplUmVhZHkgPSBmYWxzZTsKCiAgICAvLyByZXNpemVQcm9wZXJ0aWVzIGNvbnRhaW5zIDYgcmVhZC13cml0ZSBwcm9wZXJ0aWVzOgogICAgLy8gd2lkdGgsIGhlaWdodCwgb2Zmc2V0WCwgb2Zmc2V0WSwgY3VzdG9tQ2xvc2VQb3NpdGlvbiwgYWxsb3dPZmZzY3JlZW4KCiAgICAvLyBUaGUgcHJvcGVydGllcyBvYmplY3QgcGFzc2VkIGludG8gdGhpcyBmdW5jdGlvbiBtdXN0IGNvbnRhaW4gd2lkdGgsIGhlaWdodCwgb2Zmc2V0WCwgb2Zmc2V0WS4KICAgIC8vIFRoZSByZW1haW5pbmcgdHdvIHByb3BlcnRpZXMgYXJlIG9wdGlvbmFsLgogICAgdmFyIHJlcXVpcmVkUHJvcHMgPSBbICJ3aWR0aCIsICJoZWlnaHQiLCAib2Zmc2V0WCIsICJvZmZzZXRZIiBdOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCByZXF1aXJlZFByb3BzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBwcm9wbmFtZSA9IHJlcXVpcmVkUHJvcHNbaV07CiAgICAgIGlmICghcHJvcGVydGllcy5oYXNPd25Qcm9wZXJ0eShwcm9wbmFtZSkpIHsKICAgICAgICBtcmFpZC5maXJlRXJyb3JFdmVudCgKICAgICAgICAgICAgInJlcXVpcmVkIHByb3BlcnR5ICIgKyBwcm9wbmFtZSArICIgaXMgbWlzc2luZyIsCiAgICAgICAgICAgICJtcmFpZC5zZXRSZXNpemVQcm9wZXJ0aWVzIik7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICB9CgogICAgaWYgKCF2YWxpZGF0ZShwcm9wZXJ0aWVzLCAic2V0UmVzaXplUHJvcGVydGllcyIpKSB7CiAgICAgIG1yYWlkLmZpcmVFcnJvckV2ZW50KCJmYWlsZWQgdmFsaWRhdGlvbiIsICJtcmFpZC5zZXRSZXNpemVQcm9wZXJ0aWVzIik7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgYWRqdXN0bWVudHMgPSB7ICJ4IjogMCwgInkiOiAwIH07CgogICAgdmFyIGFsbG93T2Zmc2NyZWVuID0gcHJvcGVydGllcy5oYXNPd25Qcm9wZXJ0eSgiYWxsb3dPZmZzY3JlZW4iKSA/IHByb3BlcnRpZXMuYWxsb3dPZmZzY3JlZW4gOiByZXNpemVQcm9wZXJ0aWVzLmFsbG93T2Zmc2NyZWVuOwogICAgaWYgKCFhbGxvd09mZnNjcmVlbikgewogICAgICBpZiAocHJvcGVydGllcy53aWR0aCA+IG1heFNpemUud2lkdGggfHwgcHJvcGVydGllcy5oZWlnaHQgPiBtYXhTaXplLmhlaWdodCkgewogICAgICAgIG1yYWlkLmZpcmVFcnJvckV2ZW50KCJyZXNpemUgd2lkdGggb3IgaGVpZ2h0IGlzIGdyZWF0ZXIgdGhhbiB0aGUgbWF4U2l6ZSB3aWR0aCBvciBoZWlnaHQiLCAibXJhaWQuc2V0UmVzaXplUHJvcGVydGllcyIpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBhZGp1c3RtZW50cyA9IGZpdFJlc2l6ZVZpZXdPblNjcmVlbihwcm9wZXJ0aWVzKTsKICAgIH0gZWxzZSBpZiAoIWlzQ2xvc2VSZWdpb25PblNjcmVlbihwcm9wZXJ0aWVzKSkgewogICAgICBtcmFpZC5maXJlRXJyb3JFdmVudCgiY2xvc2UgZXZlbnQgcmVnaW9uIHdpbGwgbm90IGFwcGVhciBlbnRpcmVseSBvbnNjcmVlbiIsICJtcmFpZC5zZXRSZXNpemVQcm9wZXJ0aWVzIik7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgcndQcm9wcyA9IFsgIndpZHRoIiwgImhlaWdodCIsICJvZmZzZXRYIiwgIm9mZnNldFkiLCAiY3VzdG9tQ2xvc2VQb3NpdGlvbiIsICJhbGxvd09mZnNjcmVlbiIgXTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcndQcm9wcy5sZW5ndGg7IGkrKykgewogICAgICB2YXIgcHJvcG5hbWUgPSByd1Byb3BzW2ldOwogICAgICBpZiAocHJvcGVydGllcy5oYXNPd25Qcm9wZXJ0eShwcm9wbmFtZSkpIHsKICAgICAgICByZXNpemVQcm9wZXJ0aWVzW3Byb3BuYW1lXSA9IHByb3BlcnRpZXNbcHJvcG5hbWVdOwogICAgICB9CiAgICB9CgogICAgdmFyIHBhcmFtcyA9CiAgICAgICAgIndpZHRoPSIgKyByZXNpemVQcm9wZXJ0aWVzLndpZHRoICsKICAgICAgICAiJmhlaWdodD0iICsgcmVzaXplUHJvcGVydGllcy5oZWlnaHQgKwogICAgICAgICImb2Zmc2V0WD0iICsgKHJlc2l6ZVByb3BlcnRpZXMub2Zmc2V0WCArIGFkanVzdG1lbnRzLngpICsKICAgICAgICAiJm9mZnNldFk9IiArIChyZXNpemVQcm9wZXJ0aWVzLm9mZnNldFkgKyBhZGp1c3RtZW50cy55KSArCiAgICAgICAgIiZjdXN0b21DbG9zZVBvc2l0aW9uPSIgKyByZXNpemVQcm9wZXJ0aWVzLmN1c3RvbUNsb3NlUG9zaXRpb24gKwogICAgICAgICImYWxsb3dPZmZzY3JlZW49IiArIHJlc2l6ZVByb3BlcnRpZXMuYWxsb3dPZmZzY3JlZW47CgogICAgY2FsbE5hdGl2ZSgic2V0UmVzaXplUHJvcGVydGllcz8iICsgcGFyYW1zKTsKCiAgICBpc1Jlc2l6ZVJlYWR5ID0gdHJ1ZTsKICB9OwoKICBtcmFpZC5zdG9yZVBpY3R1cmUgPSBmdW5jdGlvbih1cmwpIHsKICAgIGxvZy5pKCJtcmFpZC5zdG9yZVBpY3R1cmUgIiArIHVybCk7CiAgICBpZiAoc3VwcG9ydGVkRmVhdHVyZXNbbXJhaWQuU1VQUE9SVEVEX0ZFQVRVUkVTLlNUT1JFUElDVFVSRV0pIHsKICAgICAgY2FsbE5hdGl2ZSgic3RvcmVQaWN0dXJlP3VybD0iICsgZW5jb2RlVVJJQ29tcG9uZW50KHVybCkpOwogICAgfSBlbHNlIHsKICAgICAgbG9nLmUoInN0b3JlUGljdHVyZSBpcyBub3Qgc3VwcG9ydGVkIik7CiAgICB9CiAgfTsKCiAgbXJhaWQuc3VwcG9ydHMgPSBmdW5jdGlvbihmZWF0dXJlKSB7CiAgICBsb2cuaSgibXJhaWQuc3VwcG9ydHMgIiArIGZlYXR1cmUgKyAiICIgKyBzdXBwb3J0ZWRGZWF0dXJlc1tmZWF0dXJlXSk7CiAgICB2YXIgcmV0dmFsID0gc3VwcG9ydGVkRmVhdHVyZXNbZmVhdHVyZV07CiAgICBpZiAodHlwZW9mIHJldHZhbCA9PT0gInVuZGVmaW5lZCIpIHsKICAgICAgcmV0dmFsID0gZmFsc2U7CiAgICB9CiAgICByZXR1cm4gcmV0dmFsOwogIH07CgogIG1yYWlkLnVzZUN1c3RvbUNsb3NlID0gZnVuY3Rpb24oaXNDdXN0b21DbG9zZSkgewogICAgbG9nLmkoIm1yYWlkLnVzZUN1c3RvbUNsb3NlICIgKyBpc0N1c3RvbUNsb3NlKTsKICAgIGlmIChleHBhbmRQcm9wZXJ0aWVzLnVzZUN1c3RvbUNsb3NlICE9PSBpc0N1c3RvbUNsb3NlKSB7CiAgICAgIGV4cGFuZFByb3BlcnRpZXMudXNlQ3VzdG9tQ2xvc2UgPSBpc0N1c3RvbUNsb3NlOwogICAgICBjYWxsTmF0aXZlKCJ1c2VDdXN0b21DbG9zZT91c2VDdXN0b21DbG9zZT0iCiAgICAgICAgICArIGV4cGFuZFByb3BlcnRpZXMudXNlQ3VzdG9tQ2xvc2UpOwogICAgfQogIH07CgogIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgKiBoZWxwZXIgbWV0aG9kcyBjYWxsZWQgYnkgU0RLCiAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKICAgIC8vIHNldHRlcnMgdG8gY2hhbmdlIHN0YXRlCiAgbXJhaWQuc2V0Q3VycmVudFBvc2l0aW9uID0gZnVuY3Rpb24oeCwgeSwgd2lkdGgsIGhlaWdodCkgewogICAgbG9nLmkoIm1yYWlkLnNldEN1cnJlbnRQb3NpdGlvbiAiICsgeCArICIsIiArIHkgKyAiLCIgKyB3aWR0aCArICIsIgkrIGhlaWdodCk7CgogICAgdmFyIHByZXZpb3VzU2l6ZSA9IHt9OwogICAgcHJldmlvdXNTaXplLndpZHRoID0gY3VycmVudFBvc2l0aW9uLndpZHRoOwogICAgcHJldmlvdXNTaXplLmhlaWdodCA9IGN1cnJlbnRQb3NpdGlvbi5oZWlnaHQ7CiAgICBsb2cuaSgicHJldmlvdXNTaXplICIgKyBwcmV2aW91c1NpemUud2lkdGggKyAiLCIgKyBwcmV2aW91c1NpemUuaGVpZ2h0KTsKCiAgICBjdXJyZW50UG9zaXRpb24ueCA9IHg7CiAgICBjdXJyZW50UG9zaXRpb24ueSA9IHk7CiAgICBjdXJyZW50UG9zaXRpb24ud2lkdGggPSB3aWR0aDsKICAgIGN1cnJlbnRQb3NpdGlvbi5oZWlnaHQgPSBoZWlnaHQ7CgogICAgaWYgKHdpZHRoICE9PSBwcmV2aW91c1NpemUud2lkdGggfHwgaGVpZ2h0ICE9PSBwcmV2aW91c1NpemUuaGVpZ2h0KSB7CiAgICAgIG1yYWlkLmZpcmVTaXplQ2hhbmdlRXZlbnQod2lkdGgsIGhlaWdodCk7CiAgICB9CiAgfTsKCiAgbXJhaWQuc2V0RGVmYXVsdFBvc2l0aW9uID0gZnVuY3Rpb24oeCwgeSwgd2lkdGgsIGhlaWdodCkgewogICAgbG9nLmkoIm1yYWlkLnNldERlZmF1bHRQb3NpdGlvbiAiICsgeCArICIsIiArIHkgKyAiLCIgKyB3aWR0aCArICIsIgkrIGhlaWdodCk7CiAgICBkZWZhdWx0UG9zaXRpb24ueCA9IHg7CiAgICBkZWZhdWx0UG9zaXRpb24ueSA9IHk7CiAgICBkZWZhdWx0UG9zaXRpb24ud2lkdGggPSB3aWR0aDsKICAgIGRlZmF1bHRQb3NpdGlvbi5oZWlnaHQgPSBoZWlnaHQ7CiAgfTsKCiAgbXJhaWQuc2V0RXhwYW5kU2l6ZSA9IGZ1bmN0aW9uKHdpZHRoLCBoZWlnaHQpIHsKICAgIGxvZy5pKCJtcmFpZC5zZXRFeHBhbmRTaXplICIgKyB3aWR0aCArICJ4IiArIGhlaWdodCk7CiAgICBleHBhbmRQcm9wZXJ0aWVzLndpZHRoID0gd2lkdGg7CiAgICBleHBhbmRQcm9wZXJ0aWVzLmhlaWdodCA9IGhlaWdodDsKICB9OwoKICBtcmFpZC5zZXRNYXhTaXplID0gZnVuY3Rpb24od2lkdGgsIGhlaWdodCkgewogICAgbG9nLmkoIm1yYWlkLnNldE1heFNpemUgIiArIHdpZHRoICsgIngiICsgaGVpZ2h0KTsKICAgIG1heFNpemUud2lkdGggPSB3aWR0aDsKICAgIG1heFNpemUuaGVpZ2h0ID0gaGVpZ2h0OwogIH07CgogIG1yYWlkLnNldFBsYWNlbWVudFR5cGUgPSBmdW5jdGlvbihwdCkgewogICAgbG9nLmkoIm1yYWlkLnNldFBsYWNlbWVudFR5cGUgIiArIHB0KTsKICAgIHBsYWNlbWVudFR5cGUgPSBwdDsKICB9OwoKICBtcmFpZC5zZXRTY3JlZW5TaXplID0gZnVuY3Rpb24od2lkdGgsIGhlaWdodCkgewogICAgbG9nLmkoIm1yYWlkLnNldFNjcmVlblNpemUgIiArIHdpZHRoICsgIngiICsgaGVpZ2h0KTsKICAgIHNjcmVlblNpemUud2lkdGggPSB3aWR0aDsKICAgIHNjcmVlblNpemUuaGVpZ2h0ID0gaGVpZ2h0OwogICAgaWYgKCFpc0V4cGFuZFByb3BlcnRpZXNTZXQpIHsKICAgICAgZXhwYW5kUHJvcGVydGllcy53aWR0aCA9IHdpZHRoOwogICAgICBleHBhbmRQcm9wZXJ0aWVzLmhlaWdodCA9IGhlaWdodDs7CiAgICB9CiAgfTsKCiAgbXJhaWQuc2V0U3VwcG9ydHMgPSBmdW5jdGlvbihmZWF0dXJlLCBzdXBwb3J0ZWQpIHsKICAgIGxvZy5pKCJtcmFpZC5zZXRTdXBwb3J0cyAiICsgZmVhdHVyZSArICIgIiArIHN1cHBvcnRlZCk7CiAgICBzdXBwb3J0ZWRGZWF0dXJlc1tmZWF0dXJlXSA9IHN1cHBvcnRlZDsKICB9OwoKICAvLyBtZXRob2RzIHRvIGZpcmUgZXZlbnRzCgogIG1yYWlkLmZpcmVFcnJvckV2ZW50ID0gZnVuY3Rpb24obWVzc2FnZSwgYWN0aW9uKSB7CiAgICBsb2cuaSgibXJhaWQuZmlyZUVycm9yRXZlbnQgIiArIG1lc3NhZ2UgKyAiICIgKyBhY3Rpb24pOwogICAgZmlyZUV2ZW50KG1yYWlkLkVWRU5UUy5FUlJPUiwgbWVzc2FnZSwgYWN0aW9uKTsKICB9OwoKICBtcmFpZC5maXJlUmVhZHlFdmVudCA9IGZ1bmN0aW9uKCkgewogICAgbG9nLmkoIm1yYWlkLmZpcmVSZWFkeUV2ZW50Iik7CiAgICBmaXJlRXZlbnQobXJhaWQuRVZFTlRTLlJFQURZKTsKICB9OwoKICBtcmFpZC5maXJlU2l6ZUNoYW5nZUV2ZW50ID0gZnVuY3Rpb24od2lkdGgsIGhlaWdodCkgewogICAgbG9nLmkoIm1yYWlkLmZpcmVTaXplQ2hhbmdlRXZlbnQgIiArIHdpZHRoICsgIngiICsgaGVpZ2h0KTsKICAgIGlmIChzdGF0ZSAhPT0gbXJhaWQuU1RBVEVTLkxPQURJTkcpIHsKICAgICAgZmlyZUV2ZW50KG1yYWlkLkVWRU5UUy5TSVpFQ0hBTkdFLCB3aWR0aCwgaGVpZ2h0KTsKICAgIH0KICB9OwoKICBtcmFpZC5maXJlU3RhdGVDaGFuZ2VFdmVudCA9IGZ1bmN0aW9uKG5ld1N0YXRlKSB7CiAgICBsb2cuaSgibXJhaWQuZmlyZVN0YXRlQ2hhbmdlRXZlbnQgIiArIG5ld1N0YXRlKTsKICAgIGlmIChzdGF0ZSAhPT0gbmV3U3RhdGUpIHsKICAgICAgc3RhdGUgPSBuZXdTdGF0ZTsKICAgICAgZmlyZUV2ZW50KG1yYWlkLkVWRU5UUy5TVEFURUNIQU5HRSwgc3RhdGUpOwogICAgfQogIH07CgogIG1yYWlkLmZpcmVWaWV3YWJsZUNoYW5nZUV2ZW50ID0gZnVuY3Rpb24obmV3SXNWaWV3YWJsZSkgewogICAgbG9nLmkoIm1yYWlkLmZpcmVWaWV3YWJsZUNoYW5nZUV2ZW50ICIgKyBuZXdJc1ZpZXdhYmxlKTsKICAgIGlmIChpc1ZpZXdhYmxlICE9PSBuZXdJc1ZpZXdhYmxlKSB7CiAgICAgIGlzVmlld2FibGUgPSBuZXdJc1ZpZXdhYmxlOwogICAgICBmaXJlRXZlbnQobXJhaWQuRVZFTlRTLlZJRVdBQkxFQ0hBTkdFLCBpc1ZpZXdhYmxlKTsKICAgIH0KICB9OwoKICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICogQXBwb2RlYWwgbWV0aG9kcwogICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCiAgbXJhaWQuYWRMb2FkZWQgPSBmYWxzZTsKICB2YXIgQVBQT0RFQUxfU0RLX1ZFUlNJT04gPSAiJSVWRVJTSU9OJSUiOwogIAogIG1yYWlkLm5vRmlsbCA9IGZ1bmN0aW9uKCkgewogICAgaWYgKCFtcmFpZC5hZExvYWRlZCkgewogICAgICBsb2cuaSgibXJhaWQubm9GaWxsIik7CiAgICAgIGNhbGxOYXRpdmUoIm5vRmlsbCIpOwogICAgfQogIH07CgogIG1yYWlkLmxvYWRlZCA9IGZ1bmN0aW9uKCkgewogICAgbG9nLmkoIm1yYWlkLmxvYWRlZCIpOwogICAgbXJhaWQuYWRMb2FkZWQgPSB0cnVlOwogICAgY2FsbE5hdGl2ZSgibG9hZGVkIik7CiAgfTsKCiAgbXJhaWQuZ2V0QXBwb2RlYWxWZXJzaW9uID0gZnVuY3Rpb24oKSB7CiAgICBsb2cuaSgibXJhaWQuZ2V0QXBwb2RlYWxWZXJzaW9uIik7CiAgICByZXR1cm4gQVBQT0RFQUxfU0RLX1ZFUlNJT047CiAgfTsKCiAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAqIGludGVybmFsIGhlbHBlciBtZXRob2RzCiAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKICBmdW5jdGlvbiBjYWxsTmF0aXZlKGNvbW1hbmQpIHsKICAgIHZhciBpZnJhbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJJRlJBTUUiKTsKICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoInNyYyIsICJtcmFpZDovLyIgKyBjb21tYW5kKTsKICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5hcHBlbmRDaGlsZChpZnJhbWUpOwogICAgaWZyYW1lLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoaWZyYW1lKTsKICAgIGlmcmFtZSA9IG51bGw7CiAgfTsKCiAgZnVuY3Rpb24gZmlyZUV2ZW50KGV2ZW50KSB7CiAgICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7CiAgICBhcmdzLnNoaWZ0KCk7CiAgICBsb2cuaSgiZmlyZUV2ZW50ICIgKyBldmVudCArICIgWyIgKyBhcmdzLnRvU3RyaW5nKCkgKyAiXSIpOwogICAgdmFyIHRlbXBFdmVudExpc3RlbmVycyA9IGxpc3RlbmVyc1tldmVudF07CiAgICBpZiAodGVtcEV2ZW50TGlzdGVuZXJzKSB7CiAgICAgIHZhciBldmVudExpc3RlbmVycyA9IHRlbXBFdmVudExpc3RlbmVycy5zbGljZSgpOwogICAgICB2YXIgbGVuID0gZXZlbnRMaXN0ZW5lcnMubGVuZ3RoOwogICAgICBsb2cuaShsZW4gKyAiIGxpc3RlbmVyKHMpIGZvdW5kIik7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICBldmVudExpc3RlbmVyc1tpXS5hcHBseShudWxsLCBhcmdzKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgbG9nLmkoIm5vIGxpc3RlbmVycyBmb3VuZCBmb3IgIiArIGV2ZW50KTsKICAgIH0KICB9OwoKICBmdW5jdGlvbiBjb250YWlucyh2YWx1ZSwgYXJyYXkpIHsKICAgIGZvciAoIHZhciBpIGluIGFycmF5KSB7CiAgICAgIGlmIChhcnJheVtpXSA9PT0gdmFsdWUpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGZhbHNlOwogIH07CgogIC8vIFRoZSBhY3Rpb24gcGFyYW1ldGVyIGlzIGEgc3RyaW5nIHdoaWNoIGlzIHRoZSBuYW1lIG9mIHRoZSBzZXR0ZXIgZnVuY3Rpb24KICAvLyB3aGljaCBjYWxsZWQgdGhpcyBmdW5jdGlvbgogIC8vIChpbiBvdGhlciB3b3Jkcywgc2V0RXhwYW5kUHJvcGV0aWVzLCBzZXRPcmllbnRhdGlvblByb3BlcnRpZXMsIG9yCiAgLy8gc2V0UmVzaXplUHJvcGVydGllcykuCiAgLy8gSXQgc2VydmVzIGJvdGggYXMgdGhlIGtleSB0byBnZXQgdGhlIHRoZSBhcHByb3ByaWF0ZSBzZXQgb2YgdmFsaWRhdGluZwogIC8vIGZ1bmN0aW9ucyBmcm9tIHRoZSBhbGxWYWxpZGF0b3JzIG9iamVjdAogIC8vIGFzIHdlbGwgYXMgdGhlIGFjdGlvbiBwYXJhbWV0ZXIgb2YgYW55IGVycm9yIGV2ZW50IHRoYXQgbWF5IGJlIHRocm93bi4KICBmdW5jdGlvbiB2YWxpZGF0ZShwcm9wZXJ0aWVzLCBhY3Rpb24pIHsKICAgIHZhciByZXR2YWwgPSB0cnVlOwogICAgdmFyIHZhbGlkYXRvcnMgPSBhbGxWYWxpZGF0b3JzW2FjdGlvbl07CiAgICBmb3IgKHZhciBwcm9wIGluIHByb3BlcnRpZXMpIHsKICAgICAgdmFyIHZhbGlkYXRvciA9IHZhbGlkYXRvcnNbcHJvcF07CiAgICAgIHZhciB2YWx1ZSA9IHByb3BlcnRpZXNbcHJvcF07CiAgICAgIGlmICh2YWxpZGF0b3IgJiYgIXZhbGlkYXRvcih2YWx1ZSkpIHsKICAgICAgICBtcmFpZC5maXJlRXJyb3JFdmVudCgiVmFsdWUgb2YgcHJvcGVydHkgIiArIHByb3AgKyAiICgiICsgdmFsdWUJKyAiKSBpcyBpbnZhbGlkIiwgIm1yYWlkLiIgKyBhY3Rpb24pOwogICAgICAgIHJldHZhbCA9IGZhbHNlOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmV0dmFsOwogIH07CgogIHZhciBhbGxWYWxpZGF0b3JzID0gewogICAgInNldEV4cGFuZFByb3BlcnRpZXMiIDogewogICAgICAvLyBJbiBNUkFJRCAyLjAsIHRoZSBvbmx5IHByb3BlcnR5IGluIGV4cGFuZFByb3BlcnRpZXMgd2UgYWN0dWFsbHkgY2FyZSBhYm91dCBpcyB1c2VDdXN0b21DbG9zZS4KICAgICAgLy8gU3RpbGwsIHdlJ2xsIGRvIGEgYmFzaWMgc2FuaXR5IGNoZWNrIG9uIHRoZSB3aWR0aCBhbmQgaGVpZ2h0IHByb3BlcnRpZXMsIHRvby4KICAgICAgIndpZHRoIiA6IGZ1bmN0aW9uKHdpZHRoKSB7CiAgICAgICAgcmV0dXJuICFpc05hTih3aWR0aCk7CiAgICAgIH0sCiAgICAgICJoZWlnaHQiIDogZnVuY3Rpb24oaGVpZ2h0KSB7CiAgICAgICAgcmV0dXJuICFpc05hTihoZWlnaHQpOwogICAgICB9LAogICAgICAidXNlQ3VzdG9tQ2xvc2UiIDogZnVuY3Rpb24odXNlQ3VzdG9tQ2xvc2UpIHsKICAgICAgICByZXR1cm4gKHR5cGVvZiB1c2VDdXN0b21DbG9zZSA9PT0gImJvb2xlYW4iKTsKICAgICAgfQogICAgfSwKICAgICJzZXRPcmllbnRhdGlvblByb3BlcnRpZXMiIDogewogICAgICAiYWxsb3dPcmllbnRhdGlvbkNoYW5nZSIgOiBmdW5jdGlvbihhbGxvd09yaWVudGF0aW9uQ2hhbmdlKSB7CiAgICAgICAgcmV0dXJuICh0eXBlb2YgYWxsb3dPcmllbnRhdGlvbkNoYW5nZSA9PT0gImJvb2xlYW4iKTsKICAgICAgfSwKICAgICAgImZvcmNlT3JpZW50YXRpb24iIDogZnVuY3Rpb24oZm9yY2VPcmllbnRhdGlvbikgewogICAgICAgIHZhciB2YWxpZFZhbHVlcyA9IFsgInBvcnRyYWl0IiwgImxhbmRzY2FwZSIsICJub25lIiBdOwogICAgICAgIHJldHVybiAodHlwZW9mIGZvcmNlT3JpZW50YXRpb24gPT09ICJzdHJpbmciICYmIHZhbGlkVmFsdWVzLmluZGV4T2YoZm9yY2VPcmllbnRhdGlvbikgIT09IC0xKTsKICAgICAgfQogICAgfSwKICAgICJzZXRSZXNpemVQcm9wZXJ0aWVzIiA6IHsKICAgICAgIndpZHRoIiA6IGZ1bmN0aW9uKHdpZHRoKSB7CiAgICAgICAgcmV0dXJuICFpc05hTih3aWR0aCkgJiYgNTAgPD0gd2lkdGg7CiAgICAgIH0sCiAgICAgICJoZWlnaHQiIDogZnVuY3Rpb24oaGVpZ2h0KSB7CiAgICAgICAgcmV0dXJuICFpc05hTihoZWlnaHQpICYmIDUwIDw9IGhlaWdodDsKICAgICAgfSwKICAgICAgIm9mZnNldFgiIDogZnVuY3Rpb24ob2Zmc2V0WCkgewogICAgICAgIHJldHVybiAhaXNOYU4ob2Zmc2V0WCk7CiAgICAgIH0sCiAgICAgICJvZmZzZXRZIiA6IGZ1bmN0aW9uKG9mZnNldFkpIHsKICAgICAgICByZXR1cm4gIWlzTmFOKG9mZnNldFkpOwogICAgICB9LAogICAgICAiY3VzdG9tQ2xvc2VQb3NpdGlvbiIgOiBmdW5jdGlvbihjdXN0b21DbG9zZVBvc2l0aW9uKSB7CiAgICAgICAgdmFyIHZhbGlkUG9zaXRpb25zID0gWyAidG9wLWxlZnQiLCAidG9wLWNlbnRlciIsICJ0b3AtcmlnaHQiLAogICAgICAgICAgImNlbnRlciIsCiAgICAgICAgICAiYm90dG9tLWxlZnQiLCAiYm90dG9tLWNlbnRlciIsCSJib3R0b20tcmlnaHQiIF07CiAgICAgICAgcmV0dXJuICh0eXBlb2YgY3VzdG9tQ2xvc2VQb3NpdGlvbiA9PT0gInN0cmluZyIgJiYgdmFsaWRQb3NpdGlvbnMuaW5kZXhPZihjdXN0b21DbG9zZVBvc2l0aW9uKSAhPT0gLTEpOwogICAgICB9LAogICAgICAiYWxsb3dPZmZzY3JlZW4iIDogZnVuY3Rpb24oYWxsb3dPZmZzY3JlZW4pIHsKICAgICAgICByZXR1cm4gKHR5cGVvZiBhbGxvd09mZnNjcmVlbiA9PT0gImJvb2xlYW4iKTsKICAgICAgfQogICAgfQogIH07CgogIGZ1bmN0aW9uIGlzQ2xvc2VSZWdpb25PblNjcmVlbihwcm9wZXJ0aWVzKSB7CiAgICBsb2cuZCgiaXNDbG9zZVJlZ2lvbk9uU2NyZWVuIik7CiAgICBsb2cuZCgiZGVmYXVsdFBvc2l0aW9uICIgKyBkZWZhdWx0UG9zaXRpb24ueCArICIgIiArIGRlZmF1bHRQb3NpdGlvbi55KTsKICAgIGxvZy5kKCJvZmZzZXQgIiArIHByb3BlcnRpZXMub2Zmc2V0WCArICIgIiArIHByb3BlcnRpZXMub2Zmc2V0WSk7CgogICAgdmFyIHJlc2l6ZVJlY3QgPSB7fTsKICAgIHJlc2l6ZVJlY3QueCA9IGRlZmF1bHRQb3NpdGlvbi54ICsgcHJvcGVydGllcy5vZmZzZXRYOwogICAgcmVzaXplUmVjdC55ID0gZGVmYXVsdFBvc2l0aW9uLnkgKyBwcm9wZXJ0aWVzLm9mZnNldFk7CiAgICByZXNpemVSZWN0LndpZHRoID0gcHJvcGVydGllcy53aWR0aDsKICAgIHJlc2l6ZVJlY3QuaGVpZ2h0ID0gcHJvcGVydGllcy5oZWlnaHQ7CiAgICBwcmludFJlY3QoInJlc2l6ZVJlY3QiLCByZXNpemVSZWN0KTsKCiAgICB2YXIgY3VzdG9tQ2xvc2VQb3NpdGlvbiA9IHByb3BlcnRpZXMuaGFzT3duUHJvcGVydHkoImN1c3RvbUNsb3NlUG9zaXRpb24iKSA/CiAgICAgICAgcHJvcGVydGllcy5jdXN0b21DbG9zZVBvc2l0aW9uIDogcmVzaXplUHJvcGVydGllcy5jdXN0b21DbG9zZVBvc2l0aW9uOwogICAgbG9nLmQoImN1c3RvbUNsb3NlUG9zaXRpb24gIiArIGN1c3RvbUNsb3NlUG9zaXRpb24pOwoKICAgIHZhciBjbG9zZVJlY3QgPSB7ICJ3aWR0aCI6IDUwLCAiaGVpZ2h0IjogNTAgfTsKCiAgICBpZiAoY3VzdG9tQ2xvc2VQb3NpdGlvbi5zZWFyY2goImxlZnQiKSAhPT0gLTEpIHsKICAgICAgY2xvc2VSZWN0LnggPSByZXNpemVSZWN0Lng7CiAgICB9IGVsc2UgaWYgKGN1c3RvbUNsb3NlUG9zaXRpb24uc2VhcmNoKCJjZW50ZXIiKSAhPT0gLTEpIHsKICAgICAgY2xvc2VSZWN0LnggPSByZXNpemVSZWN0LnggKyAocmVzaXplUmVjdC53aWR0aCAvIDIpIC0gMjU7CiAgICB9IGVsc2UgaWYgKGN1c3RvbUNsb3NlUG9zaXRpb24uc2VhcmNoKCJyaWdodCIpICE9PSAtMSkgewogICAgICBjbG9zZVJlY3QueCA9IHJlc2l6ZVJlY3QueCArIHJlc2l6ZVJlY3Qud2lkdGggLSA1MDsKICAgIH0KCiAgICBpZiAoY3VzdG9tQ2xvc2VQb3NpdGlvbi5zZWFyY2goInRvcCIpICE9PSAtMSkgewogICAgICBjbG9zZVJlY3QueSA9IHJlc2l6ZVJlY3QueTsKICAgIH0gZWxzZSBpZiAoY3VzdG9tQ2xvc2VQb3NpdGlvbiA9PT0gImNlbnRlciIpIHsKICAgICAgY2xvc2VSZWN0LnkgPSByZXNpemVSZWN0LnkgKyAocmVzaXplUmVjdC5oZWlnaHQgLyAyKSAtIDI1OwogICAgfSBlbHNlIGlmIChjdXN0b21DbG9zZVBvc2l0aW9uLnNlYXJjaCgiYm90dG9tIikgIT09IC0xKSB7CiAgICAgIGNsb3NlUmVjdC55ID0gcmVzaXplUmVjdC55ICsgcmVzaXplUmVjdC5oZWlnaHQgLSA1MDsKICAgIH0KCiAgICB2YXIgbWF4UmVjdCA9IHsgIngiOiAwLCAieSI6IDAgfTsKICAgIG1heFJlY3Qud2lkdGggPSBtYXhTaXplLndpZHRoOwogICAgbWF4UmVjdC5oZWlnaHQgPSBtYXhTaXplLmhlaWdodDsKCiAgICByZXR1cm4gaXNSZWN0Q29udGFpbmVkKG1heFJlY3QsIGNsb3NlUmVjdCk7CiAgfQoKICBmdW5jdGlvbiBmaXRSZXNpemVWaWV3T25TY3JlZW4ocHJvcGVydGllcykgewogICAgbG9nLmQoImZpdFJlc2l6ZVZpZXdPblNjcmVlbiIpOwogICAgbG9nLmQoImRlZmF1bHRQb3NpdGlvbiAiICsgZGVmYXVsdFBvc2l0aW9uLnggKyAiICIgKyBkZWZhdWx0UG9zaXRpb24ueSk7CiAgICBsb2cuZCgib2Zmc2V0ICIgKyBwcm9wZXJ0aWVzLm9mZnNldFggKyAiICIgKyBwcm9wZXJ0aWVzLm9mZnNldFkpOwoKICAgIHZhciByZXNpemVSZWN0ID0ge307CiAgICByZXNpemVSZWN0LnggPSBkZWZhdWx0UG9zaXRpb24ueCArIHByb3BlcnRpZXMub2Zmc2V0WDsKICAgIHJlc2l6ZVJlY3QueSA9IGRlZmF1bHRQb3NpdGlvbi55ICsgcHJvcGVydGllcy5vZmZzZXRZOwogICAgcmVzaXplUmVjdC53aWR0aCA9IHByb3BlcnRpZXMud2lkdGg7CiAgICByZXNpemVSZWN0LmhlaWdodCA9IHByb3BlcnRpZXMuaGVpZ2h0OwogICAgcHJpbnRSZWN0KCJyZXNpemVSZWN0IiwgcmVzaXplUmVjdCk7CgogICAgdmFyIG1heFJlY3QgPSB7ICJ4IjogMCwgInkiOiAwIH07CiAgICBtYXhSZWN0LndpZHRoID0gbWF4U2l6ZS53aWR0aDsKICAgIG1heFJlY3QuaGVpZ2h0ID0gbWF4U2l6ZS5oZWlnaHQ7CgogICAgdmFyIGFkanVzdG1lbnRzID0geyAieCI6IDAsICJ5IjogMCB9OwoKICAgIGlmIChpc1JlY3RDb250YWluZWQobWF4UmVjdCwgcmVzaXplUmVjdCkpIHsKICAgICAgbG9nLmQoIm5vIGFkanVzdG1lbnQgbmVjZXNzYXJ5Iik7CiAgICAgIHJldHVybiBhZGp1c3RtZW50czsKICAgIH0KCiAgICBpZiAocmVzaXplUmVjdC54IDwgbWF4UmVjdC54KSB7CiAgICAgIGFkanVzdG1lbnRzLnggPSBtYXhSZWN0LnggLSByZXNpemVSZWN0Lng7CiAgICB9IGVsc2UgaWYgKChyZXNpemVSZWN0LnggKyByZXNpemVSZWN0LndpZHRoKSA+IChtYXhSZWN0LnggKyBtYXhSZWN0LndpZHRoKSkgewogICAgICBhZGp1c3RtZW50cy54ID0gKG1heFJlY3QueCArIG1heFJlY3Qud2lkdGgpIC0gKHJlc2l6ZVJlY3QueCArIHJlc2l6ZVJlY3Qud2lkdGgpOwogICAgfQogICAgbG9nLmQoImFkanVzdG1lbnRzLnggIiArIGFkanVzdG1lbnRzLngpOwoKICAgIGlmIChyZXNpemVSZWN0LnkgPCBtYXhSZWN0LnkpIHsKICAgICAgYWRqdXN0bWVudHMueSA9IG1heFJlY3QueSAtIHJlc2l6ZVJlY3QueTsKICAgIH0gZWxzZSBpZiAoKHJlc2l6ZVJlY3QueSArIHJlc2l6ZVJlY3QuaGVpZ2h0KSA+IChtYXhSZWN0LnkgKyBtYXhSZWN0LmhlaWdodCkpIHsKICAgICAgYWRqdXN0bWVudHMueSA9IChtYXhSZWN0LnkgKyBtYXhSZWN0LmhlaWdodCkgLSAocmVzaXplUmVjdC55ICsgcmVzaXplUmVjdC5oZWlnaHQpOwogICAgfQogICAgbG9nLmQoImFkanVzdG1lbnRzLnkgIiArIGFkanVzdG1lbnRzLnkpOwoKICAgIHJlc2l6ZVJlY3QueCA9IGRlZmF1bHRQb3NpdGlvbi54ICsgcHJvcGVydGllcy5vZmZzZXRYICsgYWRqdXN0bWVudHMueDsKICAgIHJlc2l6ZVJlY3QueSA9IGRlZmF1bHRQb3NpdGlvbi55ICsgcHJvcGVydGllcy5vZmZzZXRZICsgYWRqdXN0bWVudHMueTsKICAgIHByaW50UmVjdCgiYWRqdXN0ZWQgcmVzaXplUmVjdCIsIHJlc2l6ZVJlY3QpOwoKICAgIHJldHVybiBhZGp1c3RtZW50czsKICB9CgogIGZ1bmN0aW9uIGlzUmVjdENvbnRhaW5lZChjb250YWluaW5nUmVjdCwgY29udGFpbmVkUmVjdCkgewogICAgbG9nLmQoImlzUmVjdENvbnRhaW5lZCIpOwogICAgcHJpbnRSZWN0KCJjb250YWluaW5nUmVjdCIsIGNvbnRhaW5pbmdSZWN0KTsKICAgIHByaW50UmVjdCgiY29udGFpbmVkUmVjdCIsIGNvbnRhaW5lZFJlY3QpOwogICAgcmV0dXJuIChjb250YWluZWRSZWN0LnggPj0gY29udGFpbmluZ1JlY3QueCAmJgogICAgKGNvbnRhaW5lZFJlY3QueCArIGNvbnRhaW5lZFJlY3Qud2lkdGgpIDw9IChjb250YWluaW5nUmVjdC54ICsgY29udGFpbmluZ1JlY3Qud2lkdGgpICYmCiAgICBjb250YWluZWRSZWN0LnkgPj0gY29udGFpbmluZ1JlY3QueSAmJgogICAgKGNvbnRhaW5lZFJlY3QueSArIGNvbnRhaW5lZFJlY3QuaGVpZ2h0KSA8PSAoY29udGFpbmluZ1JlY3QueSArIGNvbnRhaW5pbmdSZWN0LmhlaWdodCkpOwogIH0KCiAgZnVuY3Rpb24gcHJpbnRSZWN0KGxhYmVsLCByZWN0KSB7CiAgICBsb2cuZChsYWJlbCArCiAgICAgICAgIiBbIiArIHJlY3QueCArICIsIiArIHJlY3QueSArICJdIiArCiAgICAgICAgIixbIiArIChyZWN0LnggKyByZWN0LndpZHRoKSArICIsIiArIChyZWN0LnkgKyByZWN0LmhlaWdodCkgKyAiXSIgKwogICAgICAgICIgKCIgKyByZWN0LndpZHRoICsgIngiICsgcmVjdC5oZWlnaHQgKyAiKSIpOwogIH0KCiAgbXJhaWQuZHVtcExpc3RlbmVycyA9IGZ1bmN0aW9uKCkgewogICAgdmFyIG5FdmVudHMgPSBPYmplY3Qua2V5cyhsaXN0ZW5lcnMpLmxlbmd0aDsKICAgIGxvZy5pKCJkdW1waW5nIGxpc3RlbmVycyAoIiArIG5FdmVudHMgKyAiIGV2ZW50cykiKTsKICAgIGZvciAoIHZhciBldmVudCBpbiBsaXN0ZW5lcnMpIHsKICAgICAgdmFyIGV2ZW50TGlzdGVuZXJzID0gbGlzdGVuZXJzW2V2ZW50XTsKICAgICAgbG9nLmkoIiAgIiArIGV2ZW50ICsgIiBjb250YWlucyAiICsgZXZlbnRMaXN0ZW5lcnMubGVuZ3RoICsgIiBsaXN0ZW5lcnMiKTsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBldmVudExpc3RlbmVycy5sZW5ndGg7IGkrKykgewogICAgICAgIGxvZy5pKCIgICAgIiArIGV2ZW50TGlzdGVuZXJzW2ldKTsKICAgICAgfQogICAgfQogIH07CgogIGNvbnNvbGUubG9nKCJNUkFJRCBvYmplY3QgbG9hZGVkIik7Cgp9KSgpOw==";

    public static final String mraidVAJS = "Ly8KLy8gIG1yYWlkLmpzCi8vCgooZnVuY3Rpb24oKSB7CgogIGNvbnNvbGUubG9nKCJNUkFJRCBvYmplY3QgbG9hZGluZy4uLiIpOwoKICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICogY29uc29sZSBsb2dnaW5nIGhlbHBlcgogICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCiAgdmFyIExvZ0xldmVsRW51bSA9IHsKICAgICJERUJVRyIgICA6IDAsCiAgICAiSU5GTyIgICAgOiAxLAogICAgIldBUk5JTkciIDogMiwKICAgICJFUlJPUiIgICA6IDMsCiAgICAiTk9ORSIgICAgOiA0CiAgfTsKCiAgdmFyIGxvZ0xldmVsID0gTG9nTGV2ZWxFbnVtLk5PTkU7CiAgdmFyIGxvZyA9IHt9OwoKICBsb2cuZCA9IGZ1bmN0aW9uKG1zZykgewogICAgaWYgKGxvZ0xldmVsIDw9IExvZ0xldmVsRW51bS5ERUJVRykgewogICAgICBjb25zb2xlLmxvZygiKEQtbXJhaWQuanMpICIgKyBtc2cpOwogICAgfQogIH07CgogIGxvZy5pID0gZnVuY3Rpb24obXNnKSB7CiAgICBpZiAobG9nTGV2ZWwgPD0gTG9nTGV2ZWxFbnVtLklORk8pIHsKICAgICAgY29uc29sZS5sb2coIihJLW1yYWlkLmpzKSAiICsgbXNnKTsKICAgIH0KICB9OwoKICBsb2cudyA9IGZ1bmN0aW9uKG1zZykgewogICAgaWYgKGxvZ0xldmVsIDw9IExvZ0xldmVsRW51bS5XQVJOSU5HKSB7CiAgICAgIGNvbnNvbGUubG9nKCIoVy1tcmFpZC5qcykgIiArIG1zZyk7CiAgICB9CiAgfTsKCiAgbG9nLmUgPSBmdW5jdGlvbihtc2cpIHsKICAgIGlmIChsb2dMZXZlbCA8PSBMb2dMZXZlbEVudW0uRVJST1IpIHsKICAgICAgY29uc29sZS5sb2coIihFLW1yYWlkLmpzKSAiICsgbXNnKTsKICAgIH0KICB9OwoKICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICogTVJBSUQgZGVjbGFyYXRpb24KICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgogIHZhciBtcmFpZCA9IHdpbmRvdy5tcmFpZCA9IHt9OwoKICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICogY29uc3RhbnRzCiAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKICB2YXIgVkVSU0lPTiA9ICIyLjAiOwoKICB2YXIgU1RBVEVTID0gbXJhaWQuU1RBVEVTID0gewogICAgIkxPQURJTkciIDogImxvYWRpbmciLAogICAgIkRFRkFVTFQiIDogImRlZmF1bHQiLAogICAgIkVYUEFOREVEIiA6ICJleHBhbmRlZCIsCiAgICAiUkVTSVpFRCIgOiAicmVzaXplZCIsCiAgICAiSElEREVOIiA6ICJoaWRkZW4iCiAgfTsKCiAgdmFyIFBMQUNFTUVOVF9UWVBFUyA9IG1yYWlkLlBMQUNFTUVOVF9UWVBFUyA9IHsKICAgICJJTkxJTkUiIDogImlubGluZSIsCiAgICAiSU5URVJTVElUSUFMIiA6ICJpbnRlcnN0aXRpYWwiCiAgfTsKCiAgdmFyIFJFU0laRV9QUk9QRVJUSUVTX0NVU1RPTV9DTE9TRV9QT1NJVElPTiA9IG1yYWlkLlJFU0laRV9QUk9QRVJUSUVTX0NVU1RPTV9DTE9TRV9QT1NJVElPTiA9IHsKICAgICJUT1BfTEVGVCIgOiAidG9wLWxlZnQiLAogICAgIlRPUF9DRU5URVIiIDogInRvcC1jZW50ZXIiLAogICAgIlRPUF9SSUdIVCIgOiAidG9wLXJpZ2h0IiwKICAgICJDRU5URVIiIDogImNlbnRlciIsCiAgICAiQk9UVE9NX0xFRlQiIDogImJvdHRvbS1sZWZ0IiwKICAgICJCT1RUT01fQ0VOVEVSIiA6ICJib3R0b20tY2VudGVyIiwKICAgICJCT1RUT01fUklHSFQiIDogImJvdHRvbS1yaWdodCIKICB9OwoKICB2YXIgT1JJRU5UQVRJT05fUFJPUEVSVElFU19GT1JDRV9PUklFTlRBVElPTiA9IG1yYWlkLk9SSUVOVEFUSU9OX1BST1BFUlRJRVNfRk9SQ0VfT1JJRU5UQVRJT04gPSB7CiAgICAiUE9SVFJBSVQiIDogInBvcnRyYWl0IiwKICAgICJMQU5EU0NBUEUiIDogImxhbmRzY2FwZSIsCiAgICAiTk9ORSIgOiAibm9uZSIKICB9OwoKICB2YXIgRVZFTlRTID0gbXJhaWQuRVZFTlRTID0gewogICAgIkVSUk9SIiA6ICJlcnJvciIsCiAgICAiUkVBRFkiIDogInJlYWR5IiwKICAgICJTSVpFQ0hBTkdFIiA6ICJzaXplQ2hhbmdlIiwKICAgICJTVEFURUNIQU5HRSIgOiAic3RhdGVDaGFuZ2UiLAogICAgIlZJRVdBQkxFQ0hBTkdFIiA6ICJ2aWV3YWJsZUNoYW5nZSIKICB9OwoKICB2YXIgU1VQUE9SVEVEX0ZFQVRVUkVTID0gbXJhaWQuU1VQUE9SVEVEX0ZFQVRVUkVTID0gewogICAgIlNNUyIgOiAic21zIiwKICAgICJURUwiIDogInRlbCIsCiAgICAiQ0FMRU5EQVIiIDogImNhbGVuZGFyIiwKICAgICJTVE9SRVBJQ1RVUkUiIDogInN0b3JlUGljdHVyZSIsCiAgICAiSU5MSU5FVklERU8iIDogImlubGluZVZpZGVvIgogIH07CgogIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgKiBzdGF0ZQogICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCiAgdmFyIHN0YXRlID0gU1RBVEVTLkxPQURJTkc7CiAgdmFyIHBsYWNlbWVudFR5cGUgPSBQTEFDRU1FTlRfVFlQRVMuSU5MSU5FOwogIHZhciBzdXBwb3J0ZWRGZWF0dXJlcyA9IHt9OwogIHZhciBpc1ZpZXdhYmxlID0gZmFsc2U7CiAgdmFyIGlzRXhwYW5kUHJvcGVydGllc1NldCA9IGZhbHNlOwogIHZhciBpc1Jlc2l6ZVJlYWR5ID0gZmFsc2U7CgogIHZhciBleHBhbmRQcm9wZXJ0aWVzID0gewogICAgIndpZHRoIiA6IDAsCiAgICAiaGVpZ2h0IiA6IDAsCiAgICAidXNlQ3VzdG9tQ2xvc2UiIDogZmFsc2UsCiAgICAiaXNNb2RhbCIgOiB0cnVlCiAgfTsKCiAgdmFyIG9yaWVudGF0aW9uUHJvcGVydGllcyA9IHsKICAgICJhbGxvd09yaWVudGF0aW9uQ2hhbmdlIiA6IHRydWUsCiAgICAiZm9yY2VPcmllbnRhdGlvbiIgOiBPUklFTlRBVElPTl9QUk9QRVJUSUVTX0ZPUkNFX09SSUVOVEFUSU9OLk5PTkUKICB9OwoKICB2YXIgcmVzaXplUHJvcGVydGllcyA9IHsKICAgICJ3aWR0aCIgOiAwLAogICAgImhlaWdodCIgOiAwLAogICAgImN1c3RvbUNsb3NlUG9zaXRpb24iIDogUkVTSVpFX1BST1BFUlRJRVNfQ1VTVE9NX0NMT1NFX1BPU0lUSU9OLlRPUF9SSUdIVCwKICAgICJvZmZzZXRYIiA6IDAsCiAgICAib2Zmc2V0WSIgOiAwLAogICAgImFsbG93T2Zmc2NyZWVuIiA6IHRydWUKICB9OwoKICB2YXIgY3VycmVudFBvc2l0aW9uID0gewogICAgIngiIDogMCwKICAgICJ5IiA6IDAsCiAgICAid2lkdGgiIDogMCwKICAgICJoZWlnaHQiIDogMAogIH07CgogIHZhciBkZWZhdWx0UG9zaXRpb24gPSB7CiAgICAieCIgOiAwLAogICAgInkiIDogMCwKICAgICJ3aWR0aCIgOiAwLAogICAgImhlaWdodCIgOiAwCiAgfTsKCiAgdmFyIG1heFNpemUgPSB7CiAgICAid2lkdGgiIDogMCwKICAgICJoZWlnaHQiIDogMAogIH07CgogIHZhciBzY3JlZW5TaXplID0gewogICAgIndpZHRoIiA6IDAsCiAgICAiaGVpZ2h0IiA6IDAKICB9OwoKICB2YXIgY3VycmVudE9yaWVudGF0aW9uID0gMDsKCiAgdmFyIGxpc3RlbmVycyA9IHt9OwoKICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICogIm9mZmljaWFsIiBBUEk6IG1ldGhvZHMgY2FsbGVkIGJ5IGNyZWF0aXZlCiAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKICBtcmFpZC5hZGRFdmVudExpc3RlbmVyID0gZnVuY3Rpb24oZXZlbnQsIGxpc3RlbmVyKSB7CiAgICBsb2cuaSgibXJhaWQuYWRkRXZlbnRMaXN0ZW5lciAiICsgZXZlbnQgKyAiOiAiICsgU3RyaW5nKGxpc3RlbmVyKSk7CiAgICBpZiAoIWV2ZW50IHx8ICFsaXN0ZW5lcikgewogICAgICBtcmFpZC5maXJlRXJyb3JFdmVudCgiQm90aCBldmVudCBhbmQgbGlzdGVuZXIgYXJlIHJlcXVpcmVkLiIsICJhZGRFdmVudExpc3RlbmVyIik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICghY29udGFpbnMoZXZlbnQsIEVWRU5UUykpIHsKICAgICAgbXJhaWQuZmlyZUVycm9yRXZlbnQoIlVua25vd24gTVJBSUQgZXZlbnQ6ICIgKyBldmVudCwgImFkZEV2ZW50TGlzdGVuZXIiKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgdmFyIGxpc3RlbmVyc0ZvckV2ZW50ID0gbGlzdGVuZXJzW2V2ZW50XSA9IGxpc3RlbmVyc1tldmVudF0gfHwgW107CiAgICAvLyBjaGVjayB0byBtYWtlIHN1cmUgdGhhdCB0aGUgbGlzdGVuZXIgaXNuJ3QgYWxyZWFkeSByZWdpc3RlcmVkCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3RlbmVyc0ZvckV2ZW50Lmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBzdHIxID0gU3RyaW5nKGxpc3RlbmVyKTsKICAgICAgdmFyIHN0cjIgPSBTdHJpbmcobGlzdGVuZXJzRm9yRXZlbnRbaV0pOwogICAgICBpZiAobGlzdGVuZXIgPT09IGxpc3RlbmVyc0ZvckV2ZW50W2ldIHx8IHN0cjEgPT09IHN0cjIpIHsKICAgICAgICBsb2cuaSgibGlzdGVuZXIgIiArIHN0cjEgKyAiIGlzIGFscmVhZHkgcmVnaXN0ZXJlZCBmb3IgZXZlbnQgIiArIGV2ZW50KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgIH0KICAgIGxpc3RlbmVyc0ZvckV2ZW50LnB1c2gobGlzdGVuZXIpOwogIH07CgogIG1yYWlkLmNyZWF0ZUNhbGVuZGFyRXZlbnQgPSBmdW5jdGlvbihwYXJhbWV0ZXJzKSB7CiAgICBsb2cuaSgibXJhaWQuY3JlYXRlQ2FsZW5kYXJFdmVudCB3aXRoICIgKyBwYXJhbWV0ZXJzKTsKICAgIGlmIChzdXBwb3J0ZWRGZWF0dXJlc1ttcmFpZC5TVVBQT1JURURfRkVBVFVSRVMuQ0FMRU5EQVJdKSB7CiAgICAgIGNhbGxOYXRpdmUoImNyZWF0ZUNhbGVuZGFyRXZlbnQ/ZXZlbnRKU09OPSIJKyBKU09OLnN0cmluZ2lmeShwYXJhbWV0ZXJzKSk7CiAgICB9IGVsc2UgewogICAgICBsb2cuZSgiY3JlYXRlQ2FsZW5kYXJFdmVudCBpcyBub3Qgc3VwcG9ydGVkIik7CiAgICB9CiAgfTsKCiAgbXJhaWQuY2xvc2UgPSBmdW5jdGlvbigpIHsKICAgIGxvZy5pKCJtcmFpZC5jbG9zZSIpOwogICAgaWYgKHN0YXRlID09PSBTVEFURVMuTE9BRElORwogICAgICAgIHx8IChzdGF0ZSA9PT0gU1RBVEVTLkRFRkFVTFQgJiYgcGxhY2VtZW50VHlwZSA9PT0gUExBQ0VNRU5UX1RZUEVTLklOTElORSkKICAgICAgICB8fCBzdGF0ZSA9PT0gU1RBVEVTLkhJRERFTikgewogICAgICAvLyBkbyBub3RoaW5nCiAgICAgIHJldHVybjsKICAgIH0KICAgIGNhbGxOYXRpdmUoImNsb3NlIik7CiAgfTsKCiAgbXJhaWQuZXhwYW5kID0gZnVuY3Rpb24odXJsKSB7CiAgICBpZiAodXJsID09PSB1bmRlZmluZWQpIHsKICAgICAgbG9nLmkoIm1yYWlkLmV4cGFuZCAoMS1wYXJ0KSIpOwogICAgfSBlbHNlIHsKICAgICAgbG9nLmkoIm1yYWlkLmV4cGFuZCAiICsgdXJsKTsKICAgIH0KICAgIC8vIFRoZSBvbmx5IHRpbWUgaXQgaXMgdmFsaWQgdG8gY2FsbCBleHBhbmQgaXMgd2hlbiB0aGUgYWQgaXMKICAgIC8vIGEgYmFubmVyIGN1cnJlbnRseSBpbiBlaXRoZXIgZGVmYXVsdCBvciByZXNpemVkIHN0YXRlLgogICAgaWYgKHBsYWNlbWVudFR5cGUgIT09IFBMQUNFTUVOVF9UWVBFUy5JTkxJTkUKICAgICAgICB8fCAoc3RhdGUgIT09IFNUQVRFUy5ERUZBVUxUICYmIHN0YXRlICE9PSBTVEFURVMuUkVTSVpFRCkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHVybCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIGNhbGxOYXRpdmUoImV4cGFuZCIpOwogICAgfSBlbHNlIHsKICAgICAgY2FsbE5hdGl2ZSgiZXhwYW5kP3VybD0iICsgZW5jb2RlVVJJQ29tcG9uZW50KHVybCkpOwogICAgfQogIH07CgogIG1yYWlkLmdldEN1cnJlbnRQb3NpdGlvbiA9IGZ1bmN0aW9uKCkgewogICAgbG9nLmkoIm1yYWlkLmdldEN1cnJlbnRQb3NpdGlvbiIpOwogICAgcmV0dXJuIGN1cnJlbnRQb3NpdGlvbjsKICB9OwoKICBtcmFpZC5nZXREZWZhdWx0UG9zaXRpb24gPSBmdW5jdGlvbigpIHsKICAgIGxvZy5pKCJtcmFpZC5nZXREZWZhdWx0UG9zaXRpb24iKTsKICAgIHJldHVybiBkZWZhdWx0UG9zaXRpb247CiAgfTsKCiAgbXJhaWQuZ2V0RXhwYW5kUHJvcGVydGllcyA9IGZ1bmN0aW9uKCkgewogICAgbG9nLmkoIm1yYWlkLmdldEV4cGFuZFByb3BlcnRpZXMiKTsKICAgIHJldHVybiBleHBhbmRQcm9wZXJ0aWVzOwogIH07CgogIG1yYWlkLmdldE1heFNpemUgPSBmdW5jdGlvbigpIHsKICAgIGxvZy5pKCJtcmFpZC5nZXRNYXhTaXplIik7CiAgICByZXR1cm4gbWF4U2l6ZTsKICB9OwoKICBtcmFpZC5nZXRPcmllbnRhdGlvblByb3BlcnRpZXMgPSBmdW5jdGlvbigpIHsKICAgIGxvZy5pKCJtcmFpZC5nZXRPcmllbnRhdGlvblByb3BlcnRpZXMiKTsKICAgIHJldHVybiBvcmllbnRhdGlvblByb3BlcnRpZXM7CiAgfTsKCiAgbXJhaWQuZ2V0UGxhY2VtZW50VHlwZSA9IGZ1bmN0aW9uKCkgewogICAgbG9nLmkoIm1yYWlkLmdldFBsYWNlbWVudFR5cGUiKTsKICAgIHJldHVybiBwbGFjZW1lbnRUeXBlOwogIH07CgogIG1yYWlkLmdldFJlc2l6ZVByb3BlcnRpZXMgPSBmdW5jdGlvbigpIHsKICAgIGxvZy5pKCJtcmFpZC5nZXRSZXNpemVQcm9wZXJ0aWVzIik7CiAgICByZXR1cm4gcmVzaXplUHJvcGVydGllczsKICB9OwoKICBtcmFpZC5nZXRTY3JlZW5TaXplID0gZnVuY3Rpb24oKSB7CiAgICBsb2cuaSgibXJhaWQuZ2V0U2NyZWVuU2l6ZSIpOwogICAgcmV0dXJuIHNjcmVlblNpemU7CiAgfTsKCiAgbXJhaWQuZ2V0U3RhdGUgPSBmdW5jdGlvbigpIHsKICAgIGxvZy5pKCJtcmFpZC5nZXRTdGF0ZSIpOwogICAgcmV0dXJuIHN0YXRlOwogIH07CgogIG1yYWlkLmdldFZlcnNpb24gPSBmdW5jdGlvbigpIHsKICAgIGxvZy5pKCJtcmFpZC5nZXRWZXJzaW9uIik7CiAgICByZXR1cm4gVkVSU0lPTjsKICB9OwoKICBtcmFpZC5pc1ZpZXdhYmxlID0gZnVuY3Rpb24oKSB7CiAgICBsb2cuaSgibXJhaWQuaXNWaWV3YWJsZSIpOwogICAgcmV0dXJuIGlzVmlld2FibGU7CiAgfTsKCiAgbXJhaWQub3BlbiA9IGZ1bmN0aW9uKHVybCkgewogICAgbG9nLmkoIm1yYWlkLm9wZW4gIiArIHVybCk7CiAgICBjYWxsTmF0aXZlKCJvcGVuP3VybD0iICsgZW5jb2RlVVJJQ29tcG9uZW50KHVybCkpOwogIH07CgogIG1yYWlkLnBsYXlWaWRlbyA9IGZ1bmN0aW9uKHVybCkgewogICAgbG9nLmkoIm1yYWlkLnBsYXlWaWRlbyAiICsgdXJsKTsKICAgIGNhbGxOYXRpdmUoInBsYXlWaWRlbz91cmw9IiArIGVuY29kZVVSSUNvbXBvbmVudCh1cmwpKTsKICB9OwoKICBtcmFpZC5yZW1vdmVFdmVudExpc3RlbmVyID0gZnVuY3Rpb24oZXZlbnQsIGxpc3RlbmVyKSB7CiAgICBsb2cuaSgibXJhaWQucmVtb3ZlRXZlbnRMaXN0ZW5lciAiICsgZXZlbnQgKyAiIDogIiArIFN0cmluZyhsaXN0ZW5lcikpOwogICAgaWYgKCFldmVudCkgewogICAgICBtcmFpZC5maXJlRXJyb3JFdmVudCgiRXZlbnQgaXMgcmVxdWlyZWQuIiwgInJlbW92ZUV2ZW50TGlzdGVuZXIiKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKCFjb250YWlucyhldmVudCwgRVZFTlRTKSkgewogICAgICBtcmFpZC5maXJlRXJyb3JFdmVudCgiVW5rbm93biBNUkFJRCBldmVudDogIiArIGV2ZW50LCAicmVtb3ZlRXZlbnRMaXN0ZW5lciIpOwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAobGlzdGVuZXJzLmhhc093blByb3BlcnR5KGV2ZW50KSkgewogICAgICBpZiAobGlzdGVuZXIpIHsKICAgICAgICB2YXIgbGlzdGVuZXJzRm9yRXZlbnQgPSBsaXN0ZW5lcnNbZXZlbnRdOwogICAgICAgIC8vIHRyeSB0byBmaW5kIHRoZSBnaXZlbiBsaXN0ZW5lcgogICAgICAgIHZhciBsZW4gPSBsaXN0ZW5lcnNGb3JFdmVudC5sZW5ndGg7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgdmFyIHJlZ2lzdGVyZWRMaXN0ZW5lciA9IGxpc3RlbmVyc0ZvckV2ZW50W2ldOwogICAgICAgICAgdmFyIHN0cjEgPSBTdHJpbmcobGlzdGVuZXIpOwogICAgICAgICAgdmFyIHN0cjIgPSBTdHJpbmcocmVnaXN0ZXJlZExpc3RlbmVyKTsKICAgICAgICAgIGlmIChsaXN0ZW5lciA9PT0gcmVnaXN0ZXJlZExpc3RlbmVyIHx8IHN0cjEgPT09IHN0cjIpIHsKICAgICAgICAgICAgbGlzdGVuZXJzRm9yRXZlbnQuc3BsaWNlKGksIDEpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGkgPT09IGxlbikgewogICAgICAgICAgbG9nLmkoImxpc3RlbmVyICIgKyBzdHIxICsgIiBub3QgZm91bmQgZm9yIGV2ZW50ICIgKyBldmVudCk7CiAgICAgICAgfQogICAgICAgIGlmIChsaXN0ZW5lcnNGb3JFdmVudC5sZW5ndGggPT09IDApIHsKICAgICAgICAgIGRlbGV0ZSBsaXN0ZW5lcnNbZXZlbnRdOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBubyBsaXN0ZW5lciB0byByZW1vdmUgd2FzIHByb3ZpZGVkLCBzbyByZW1vdmUgYWxsIGxpc3RlbmVycwogICAgICAgIC8vIGZvciBnaXZlbiBldmVudAogICAgICAgIGRlbGV0ZSBsaXN0ZW5lcnNbZXZlbnRdOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBsb2cuaSgibm8gbGlzdGVuZXJzIHJlZ2lzdGVyZWQgZm9yIGV2ZW50ICIgKyBldmVudCk7CiAgICB9CiAgfTsKCiAgbXJhaWQucmVzaXplID0gZnVuY3Rpb24oKSB7CiAgICBsb2cuaSgibXJhaWQucmVzaXplIik7CiAgICAvLyBUaGUgb25seSB0aW1lIGl0IGlzIHZhbGlkIHRvIGNhbGwgcmVzaXplIGlzIHdoZW4gdGhlIGFkIGlzCiAgICAvLyBhIGJhbm5lciBjdXJyZW50bHkgaW4gZWl0aGVyIGRlZmF1bHQgb3IgcmVzaXplZCBzdGF0ZS4KICAgIC8vIFRyaWdnZXIgYW4gZXJyb3IgaWYgdGhlIGN1cnJlbnQgc3RhdGUgaXMgZXhwYW5kZWQuCiAgICBpZiAocGxhY2VtZW50VHlwZSA9PT0gUExBQ0VNRU5UX1RZUEVTLklOVEVSU1RJVElBTCB8fCBzdGF0ZSA9PT0gU1RBVEVTLkxPQURJTkcgfHwgc3RhdGUgPT09IFNUQVRFUy5ISURERU4pIHsKICAgICAgLy8gZG8gbm90aGluZwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoc3RhdGUgPT09IFNUQVRFUy5FWFBBTkRFRCkgewogICAgICBtcmFpZC5maXJlRXJyb3JFdmVudCgibXJhaWQucmVzaXplIGNhbGxlZCB3aGVuIGFkIGlzIGluIGV4cGFuZGVkIHN0YXRlIiwgIm1yYWlkLnJlc2l6ZSIpOwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoIWlzUmVzaXplUmVhZHkpIHsKICAgICAgbXJhaWQuZmlyZUVycm9yRXZlbnQoIm1yYWlkLnJlc2l6ZSBpcyBub3QgcmVhZHkgdG8gYmUgY2FsbGVkIiwgIm1yYWlkLnJlc2l6ZSIpOwogICAgICByZXR1cm47CiAgICB9CiAgICBjYWxsTmF0aXZlKCJyZXNpemUiKTsKICB9OwoKICBtcmFpZC5zZXRFeHBhbmRQcm9wZXJ0aWVzID0gZnVuY3Rpb24ocHJvcGVydGllcykgewogICAgbG9nLmkoIm1yYWlkLnNldEV4cGFuZFByb3BlcnRpZXMiKTsKCiAgICBpZiAoIXZhbGlkYXRlKHByb3BlcnRpZXMsICJzZXRFeHBhbmRQcm9wZXJ0aWVzIikpIHsKICAgICAgbG9nLmUoImZhaWxlZCB2YWxpZGF0aW9uIik7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgb2xkVXNlQ3VzdG9tQ2xvc2UgPSBleHBhbmRQcm9wZXJ0aWVzLnVzZUN1c3RvbUNsb3NlOwoKICAgIC8vIGV4cGFuZFByb3BlcnRpZXMgY29udGFpbnMgMyByZWFkLXdyaXRlIHByb3BlcnRpZXM6IHdpZHRoLCBoZWlnaHQsIGFuZCB1c2VDdXN0b21DbG9zZTsKICAgIC8vIHRoZSBpc01vZGFsIHByb3BlcnR5IGlzIHJlYWQtb25seQogICAgdmFyIHJ3UHJvcHMgPSBbICJ3aWR0aCIsICJoZWlnaHQiLCAidXNlQ3VzdG9tQ2xvc2UiIF07CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJ3UHJvcHMubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIHByb3BuYW1lID0gcndQcm9wc1tpXTsKICAgICAgaWYgKHByb3BlcnRpZXMuaGFzT3duUHJvcGVydHkocHJvcG5hbWUpKSB7CiAgICAgICAgZXhwYW5kUHJvcGVydGllc1twcm9wbmFtZV0gPSBwcm9wZXJ0aWVzW3Byb3BuYW1lXTsKICAgICAgfQogICAgfQoKICAgIC8vIEluIE1SQUlEIHYyLjAsIGFsbCBleHBhbmRlZCBhZHMgYnkgZGVmaW5pdGlvbiBjb3ZlciB0aGUgZW50aXJlIHNjcmVlbiwKICAgIC8vIHNvIHRoZSBvbmx5IHByb3BlcnR5IHRoYXQgdGhlIG5hdGl2ZSBzaWRlIGhhcyB0byBrbm93IGFib3V0IGlzIHVzZUN1c3RvbUNsb3NlLgogICAgLy8gKFRoYXQgaXMsIHRoZSB3aWR0aCBhbmQgaGVpZ2h0IHByb3BlcnRpZXMgYXJlIG5vdCBuZWVkZWQgYnkgdGhlIG5hdGl2ZSBjb2RlLikKICAgIGlmIChleHBhbmRQcm9wZXJ0aWVzLnVzZUN1c3RvbUNsb3NlICE9PSBvbGRVc2VDdXN0b21DbG9zZSkgewogICAgICBjYWxsTmF0aXZlKCJ1c2VDdXN0b21DbG9zZT91c2VDdXN0b21DbG9zZT0iCSsgZXhwYW5kUHJvcGVydGllcy51c2VDdXN0b21DbG9zZSk7CiAgICB9CgogICAgaXNFeHBhbmRQcm9wZXJ0aWVzU2V0ID0gdHJ1ZTsKICB9OwoKICBtcmFpZC5zZXRPcmllbnRhdGlvblByb3BlcnRpZXMgPSBmdW5jdGlvbihwcm9wZXJ0aWVzKSB7CiAgICBsb2cuaSgibXJhaWQuc2V0T3JpZW50YXRpb25Qcm9wZXJ0aWVzIik7CgogICAgaWYgKCF2YWxpZGF0ZShwcm9wZXJ0aWVzLCAic2V0T3JpZW50YXRpb25Qcm9wZXJ0aWVzIikpIHsKICAgICAgbG9nLmUoImZhaWxlZCB2YWxpZGF0aW9uIik7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgbmV3T3JpZW50YXRpb25Qcm9wZXJ0aWVzID0ge307CiAgICBuZXdPcmllbnRhdGlvblByb3BlcnRpZXMuYWxsb3dPcmllbnRhdGlvbkNoYW5nZSA9IG9yaWVudGF0aW9uUHJvcGVydGllcy5hbGxvd09yaWVudGF0aW9uQ2hhbmdlLAogICAgICAgIG5ld09yaWVudGF0aW9uUHJvcGVydGllcy5mb3JjZU9yaWVudGF0aW9uID0gb3JpZW50YXRpb25Qcm9wZXJ0aWVzLmZvcmNlT3JpZW50YXRpb247CgogICAgLy8gb3JpZW50YXRpb25Qcm9wZXJ0aWVzIGNvbnRhaW5zIDIgcmVhZC13cml0ZSBwcm9wZXJ0aWVzOgogICAgLy8gYWxsb3dPcmllbnRhdGlvbkNoYW5nZSBhbmQgZm9yY2VPcmllbnRhdGlvbgogICAgdmFyIHJ3UHJvcHMgPSBbICJhbGxvd09yaWVudGF0aW9uQ2hhbmdlIiwgImZvcmNlT3JpZW50YXRpb24iIF07CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJ3UHJvcHMubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIHByb3BuYW1lID0gcndQcm9wc1tpXTsKICAgICAgaWYgKHByb3BlcnRpZXMuaGFzT3duUHJvcGVydHkocHJvcG5hbWUpKSB7CiAgICAgICAgbmV3T3JpZW50YXRpb25Qcm9wZXJ0aWVzW3Byb3BuYW1lXSA9IHByb3BlcnRpZXNbcHJvcG5hbWVdOwogICAgICB9CiAgICB9CgogICAgLy8gU2V0dGluZyBhbGxvd09yaWVudGF0aW9uQ2hhbmdlIHRvIHRydWUgd2hpbGUgc2V0dGluZyBmb3JjZU9yaWVudGF0aW9uCiAgICAvLyB0byBlaXRoZXIgcG9ydHJhaXQgb3IgbGFuZHNjYXBlCiAgICAvLyBpcyBjb25zaWRlcmVkIGFuIGVycm9yIGNvbmRpdGlvbi4KICAgIGlmIChuZXdPcmllbnRhdGlvblByb3BlcnRpZXMuYWxsb3dPcmllbnRhdGlvbkNoYW5nZQogICAgICAgICYmIG5ld09yaWVudGF0aW9uUHJvcGVydGllcy5mb3JjZU9yaWVudGF0aW9uICE9PSBtcmFpZC5PUklFTlRBVElPTl9QUk9QRVJUSUVTX0ZPUkNFX09SSUVOVEFUSU9OLk5PTkUpIHsKICAgICAgbXJhaWQuZmlyZUVycm9yRXZlbnQoCiAgICAgICAgICAiYWxsb3dPcmllbnRhdGlvbkNoYW5nZSBpcyB0cnVlIGJ1dCBmb3JjZU9yaWVudGF0aW9uIGlzICIKICAgICAgICAgICsgbmV3T3JpZW50YXRpb25Qcm9wZXJ0aWVzLmZvcmNlT3JpZW50YXRpb24sCiAgICAgICAgICAic2V0T3JpZW50YXRpb25Qcm9wZXJ0aWVzIik7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBvcmllbnRhdGlvblByb3BlcnRpZXMuYWxsb3dPcmllbnRhdGlvbkNoYW5nZSA9IG5ld09yaWVudGF0aW9uUHJvcGVydGllcy5hbGxvd09yaWVudGF0aW9uQ2hhbmdlOwogICAgb3JpZW50YXRpb25Qcm9wZXJ0aWVzLmZvcmNlT3JpZW50YXRpb24gPSBuZXdPcmllbnRhdGlvblByb3BlcnRpZXMuZm9yY2VPcmllbnRhdGlvbjsKCiAgICB2YXIgcGFyYW1zID0gImFsbG93T3JpZW50YXRpb25DaGFuZ2U9IgogICAgICAgICsgb3JpZW50YXRpb25Qcm9wZXJ0aWVzLmFsbG93T3JpZW50YXRpb25DaGFuZ2UKICAgICAgICArICImZm9yY2VPcmllbnRhdGlvbj0iICsgb3JpZW50YXRpb25Qcm9wZXJ0aWVzLmZvcmNlT3JpZW50YXRpb247CgogICAgY2FsbE5hdGl2ZSgic2V0T3JpZW50YXRpb25Qcm9wZXJ0aWVzPyIgKyBwYXJhbXMpOwogIH07CgogIG1yYWlkLnNldFJlc2l6ZVByb3BlcnRpZXMgPSBmdW5jdGlvbihwcm9wZXJ0aWVzKSB7CiAgICBsb2cuaSgibXJhaWQuc2V0UmVzaXplUHJvcGVydGllcyIpOwoKICAgIGlzUmVzaXplUmVhZHkgPSBmYWxzZTsKCiAgICAvLyByZXNpemVQcm9wZXJ0aWVzIGNvbnRhaW5zIDYgcmVhZC13cml0ZSBwcm9wZXJ0aWVzOgogICAgLy8gd2lkdGgsIGhlaWdodCwgb2Zmc2V0WCwgb2Zmc2V0WSwgY3VzdG9tQ2xvc2VQb3NpdGlvbiwgYWxsb3dPZmZzY3JlZW4KCiAgICAvLyBUaGUgcHJvcGVydGllcyBvYmplY3QgcGFzc2VkIGludG8gdGhpcyBmdW5jdGlvbiBtdXN0IGNvbnRhaW4gd2lkdGgsIGhlaWdodCwgb2Zmc2V0WCwgb2Zmc2V0WS4KICAgIC8vIFRoZSByZW1haW5pbmcgdHdvIHByb3BlcnRpZXMgYXJlIG9wdGlvbmFsLgogICAgdmFyIHJlcXVpcmVkUHJvcHMgPSBbICJ3aWR0aCIsICJoZWlnaHQiLCAib2Zmc2V0WCIsICJvZmZzZXRZIiBdOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCByZXF1aXJlZFByb3BzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBwcm9wbmFtZSA9IHJlcXVpcmVkUHJvcHNbaV07CiAgICAgIGlmICghcHJvcGVydGllcy5oYXNPd25Qcm9wZXJ0eShwcm9wbmFtZSkpIHsKICAgICAgICBtcmFpZC5maXJlRXJyb3JFdmVudCgKICAgICAgICAgICAgInJlcXVpcmVkIHByb3BlcnR5ICIgKyBwcm9wbmFtZSArICIgaXMgbWlzc2luZyIsCiAgICAgICAgICAgICJtcmFpZC5zZXRSZXNpemVQcm9wZXJ0aWVzIik7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICB9CgogICAgaWYgKCF2YWxpZGF0ZShwcm9wZXJ0aWVzLCAic2V0UmVzaXplUHJvcGVydGllcyIpKSB7CiAgICAgIG1yYWlkLmZpcmVFcnJvckV2ZW50KCJmYWlsZWQgdmFsaWRhdGlvbiIsICJtcmFpZC5zZXRSZXNpemVQcm9wZXJ0aWVzIik7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgYWRqdXN0bWVudHMgPSB7ICJ4IjogMCwgInkiOiAwIH07CgogICAgdmFyIGFsbG93T2Zmc2NyZWVuID0gcHJvcGVydGllcy5oYXNPd25Qcm9wZXJ0eSgiYWxsb3dPZmZzY3JlZW4iKSA/IHByb3BlcnRpZXMuYWxsb3dPZmZzY3JlZW4gOiByZXNpemVQcm9wZXJ0aWVzLmFsbG93T2Zmc2NyZWVuOwogICAgaWYgKCFhbGxvd09mZnNjcmVlbikgewogICAgICBpZiAocHJvcGVydGllcy53aWR0aCA+IG1heFNpemUud2lkdGggfHwgcHJvcGVydGllcy5oZWlnaHQgPiBtYXhTaXplLmhlaWdodCkgewogICAgICAgIG1yYWlkLmZpcmVFcnJvckV2ZW50KCJyZXNpemUgd2lkdGggb3IgaGVpZ2h0IGlzIGdyZWF0ZXIgdGhhbiB0aGUgbWF4U2l6ZSB3aWR0aCBvciBoZWlnaHQiLCAibXJhaWQuc2V0UmVzaXplUHJvcGVydGllcyIpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBhZGp1c3RtZW50cyA9IGZpdFJlc2l6ZVZpZXdPblNjcmVlbihwcm9wZXJ0aWVzKTsKICAgIH0gZWxzZSBpZiAoIWlzQ2xvc2VSZWdpb25PblNjcmVlbihwcm9wZXJ0aWVzKSkgewogICAgICBtcmFpZC5maXJlRXJyb3JFdmVudCgiY2xvc2UgZXZlbnQgcmVnaW9uIHdpbGwgbm90IGFwcGVhciBlbnRpcmVseSBvbnNjcmVlbiIsICJtcmFpZC5zZXRSZXNpemVQcm9wZXJ0aWVzIik7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgcndQcm9wcyA9IFsgIndpZHRoIiwgImhlaWdodCIsICJvZmZzZXRYIiwgIm9mZnNldFkiLCAiY3VzdG9tQ2xvc2VQb3NpdGlvbiIsICJhbGxvd09mZnNjcmVlbiIgXTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcndQcm9wcy5sZW5ndGg7IGkrKykgewogICAgICB2YXIgcHJvcG5hbWUgPSByd1Byb3BzW2ldOwogICAgICBpZiAocHJvcGVydGllcy5oYXNPd25Qcm9wZXJ0eShwcm9wbmFtZSkpIHsKICAgICAgICByZXNpemVQcm9wZXJ0aWVzW3Byb3BuYW1lXSA9IHByb3BlcnRpZXNbcHJvcG5hbWVdOwogICAgICB9CiAgICB9CgogICAgdmFyIHBhcmFtcyA9CiAgICAgICAgIndpZHRoPSIgKyByZXNpemVQcm9wZXJ0aWVzLndpZHRoICsKICAgICAgICAiJmhlaWdodD0iICsgcmVzaXplUHJvcGVydGllcy5oZWlnaHQgKwogICAgICAgICImb2Zmc2V0WD0iICsgKHJlc2l6ZVByb3BlcnRpZXMub2Zmc2V0WCArIGFkanVzdG1lbnRzLngpICsKICAgICAgICAiJm9mZnNldFk9IiArIChyZXNpemVQcm9wZXJ0aWVzLm9mZnNldFkgKyBhZGp1c3RtZW50cy55KSArCiAgICAgICAgIiZjdXN0b21DbG9zZVBvc2l0aW9uPSIgKyByZXNpemVQcm9wZXJ0aWVzLmN1c3RvbUNsb3NlUG9zaXRpb24gKwogICAgICAgICImYWxsb3dPZmZzY3JlZW49IiArIHJlc2l6ZVByb3BlcnRpZXMuYWxsb3dPZmZzY3JlZW47CgogICAgY2FsbE5hdGl2ZSgic2V0UmVzaXplUHJvcGVydGllcz8iICsgcGFyYW1zKTsKCiAgICBpc1Jlc2l6ZVJlYWR5ID0gdHJ1ZTsKICB9OwoKICBtcmFpZC5zdG9yZVBpY3R1cmUgPSBmdW5jdGlvbih1cmwpIHsKICAgIGxvZy5pKCJtcmFpZC5zdG9yZVBpY3R1cmUgIiArIHVybCk7CiAgICBpZiAoc3VwcG9ydGVkRmVhdHVyZXNbbXJhaWQuU1VQUE9SVEVEX0ZFQVRVUkVTLlNUT1JFUElDVFVSRV0pIHsKICAgICAgY2FsbE5hdGl2ZSgic3RvcmVQaWN0dXJlP3VybD0iICsgZW5jb2RlVVJJQ29tcG9uZW50KHVybCkpOwogICAgfSBlbHNlIHsKICAgICAgbG9nLmUoInN0b3JlUGljdHVyZSBpcyBub3Qgc3VwcG9ydGVkIik7CiAgICB9CiAgfTsKCiAgbXJhaWQuc3VwcG9ydHMgPSBmdW5jdGlvbihmZWF0dXJlKSB7CiAgICBsb2cuaSgibXJhaWQuc3VwcG9ydHMgIiArIGZlYXR1cmUgKyAiICIgKyBzdXBwb3J0ZWRGZWF0dXJlc1tmZWF0dXJlXSk7CiAgICB2YXIgcmV0dmFsID0gc3VwcG9ydGVkRmVhdHVyZXNbZmVhdHVyZV07CiAgICBpZiAodHlwZW9mIHJldHZhbCA9PT0gInVuZGVmaW5lZCIpIHsKICAgICAgcmV0dmFsID0gZmFsc2U7CiAgICB9CiAgICByZXR1cm4gcmV0dmFsOwogIH07CgogIG1yYWlkLnVzZUN1c3RvbUNsb3NlID0gZnVuY3Rpb24oaXNDdXN0b21DbG9zZSkgewogICAgbG9nLmkoIm1yYWlkLnVzZUN1c3RvbUNsb3NlICIgKyBpc0N1c3RvbUNsb3NlKTsKICAgIGlmIChleHBhbmRQcm9wZXJ0aWVzLnVzZUN1c3RvbUNsb3NlICE9PSBpc0N1c3RvbUNsb3NlKSB7CiAgICAgIGV4cGFuZFByb3BlcnRpZXMudXNlQ3VzdG9tQ2xvc2UgPSBpc0N1c3RvbUNsb3NlOwogICAgICBjYWxsTmF0aXZlKCJ1c2VDdXN0b21DbG9zZT91c2VDdXN0b21DbG9zZT0iCiAgICAgICAgICArIGV4cGFuZFByb3BlcnRpZXMudXNlQ3VzdG9tQ2xvc2UpOwogICAgfQogIH07CgogIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgKiBoZWxwZXIgbWV0aG9kcyBjYWxsZWQgYnkgU0RLCiAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKICAgIC8vIHNldHRlcnMgdG8gY2hhbmdlIHN0YXRlCiAgbXJhaWQuc2V0Q3VycmVudFBvc2l0aW9uID0gZnVuY3Rpb24oeCwgeSwgd2lkdGgsIGhlaWdodCkgewogICAgbG9nLmkoIm1yYWlkLnNldEN1cnJlbnRQb3NpdGlvbiAiICsgeCArICIsIiArIHkgKyAiLCIgKyB3aWR0aCArICIsIgkrIGhlaWdodCk7CgogICAgdmFyIHByZXZpb3VzU2l6ZSA9IHt9OwogICAgcHJldmlvdXNTaXplLndpZHRoID0gY3VycmVudFBvc2l0aW9uLndpZHRoOwogICAgcHJldmlvdXNTaXplLmhlaWdodCA9IGN1cnJlbnRQb3NpdGlvbi5oZWlnaHQ7CiAgICBsb2cuaSgicHJldmlvdXNTaXplICIgKyBwcmV2aW91c1NpemUud2lkdGggKyAiLCIgKyBwcmV2aW91c1NpemUuaGVpZ2h0KTsKCiAgICBjdXJyZW50UG9zaXRpb24ueCA9IHg7CiAgICBjdXJyZW50UG9zaXRpb24ueSA9IHk7CiAgICBjdXJyZW50UG9zaXRpb24ud2lkdGggPSB3aWR0aDsKICAgIGN1cnJlbnRQb3NpdGlvbi5oZWlnaHQgPSBoZWlnaHQ7CgogICAgaWYgKHdpZHRoICE9PSBwcmV2aW91c1NpemUud2lkdGggfHwgaGVpZ2h0ICE9PSBwcmV2aW91c1NpemUuaGVpZ2h0KSB7CiAgICAgIG1yYWlkLmZpcmVTaXplQ2hhbmdlRXZlbnQod2lkdGgsIGhlaWdodCk7CiAgICB9CiAgfTsKCiAgbXJhaWQuc2V0RGVmYXVsdFBvc2l0aW9uID0gZnVuY3Rpb24oeCwgeSwgd2lkdGgsIGhlaWdodCkgewogICAgbG9nLmkoIm1yYWlkLnNldERlZmF1bHRQb3NpdGlvbiAiICsgeCArICIsIiArIHkgKyAiLCIgKyB3aWR0aCArICIsIgkrIGhlaWdodCk7CiAgICBkZWZhdWx0UG9zaXRpb24ueCA9IHg7CiAgICBkZWZhdWx0UG9zaXRpb24ueSA9IHk7CiAgICBkZWZhdWx0UG9zaXRpb24ud2lkdGggPSB3aWR0aDsKICAgIGRlZmF1bHRQb3NpdGlvbi5oZWlnaHQgPSBoZWlnaHQ7CiAgfTsKCiAgbXJhaWQuc2V0RXhwYW5kU2l6ZSA9IGZ1bmN0aW9uKHdpZHRoLCBoZWlnaHQpIHsKICAgIGxvZy5pKCJtcmFpZC5zZXRFeHBhbmRTaXplICIgKyB3aWR0aCArICJ4IiArIGhlaWdodCk7CiAgICBleHBhbmRQcm9wZXJ0aWVzLndpZHRoID0gd2lkdGg7CiAgICBleHBhbmRQcm9wZXJ0aWVzLmhlaWdodCA9IGhlaWdodDsKICB9OwoKICBtcmFpZC5zZXRNYXhTaXplID0gZnVuY3Rpb24od2lkdGgsIGhlaWdodCkgewogICAgbG9nLmkoIm1yYWlkLnNldE1heFNpemUgIiArIHdpZHRoICsgIngiICsgaGVpZ2h0KTsKICAgIG1heFNpemUud2lkdGggPSB3aWR0aDsKICAgIG1heFNpemUuaGVpZ2h0ID0gaGVpZ2h0OwogIH07CgogIG1yYWlkLnNldFBsYWNlbWVudFR5cGUgPSBmdW5jdGlvbihwdCkgewogICAgbG9nLmkoIm1yYWlkLnNldFBsYWNlbWVudFR5cGUgIiArIHB0KTsKICAgIHBsYWNlbWVudFR5cGUgPSBwdDsKICB9OwoKICBtcmFpZC5zZXRTY3JlZW5TaXplID0gZnVuY3Rpb24od2lkdGgsIGhlaWdodCkgewogICAgbG9nLmkoIm1yYWlkLnNldFNjcmVlblNpemUgIiArIHdpZHRoICsgIngiICsgaGVpZ2h0KTsKICAgIHNjcmVlblNpemUud2lkdGggPSB3aWR0aDsKICAgIHNjcmVlblNpemUuaGVpZ2h0ID0gaGVpZ2h0OwogICAgaWYgKCFpc0V4cGFuZFByb3BlcnRpZXNTZXQpIHsKICAgICAgZXhwYW5kUHJvcGVydGllcy53aWR0aCA9IHdpZHRoOwogICAgICBleHBhbmRQcm9wZXJ0aWVzLmhlaWdodCA9IGhlaWdodDs7CiAgICB9CiAgfTsKCiAgbXJhaWQuc2V0U3VwcG9ydHMgPSBmdW5jdGlvbihmZWF0dXJlLCBzdXBwb3J0ZWQpIHsKICAgIGxvZy5pKCJtcmFpZC5zZXRTdXBwb3J0cyAiICsgZmVhdHVyZSArICIgIiArIHN1cHBvcnRlZCk7CiAgICBzdXBwb3J0ZWRGZWF0dXJlc1tmZWF0dXJlXSA9IHN1cHBvcnRlZDsKICB9OwoKICAvLyBtZXRob2RzIHRvIGZpcmUgZXZlbnRzCgogIG1yYWlkLmZpcmVFcnJvckV2ZW50ID0gZnVuY3Rpb24obWVzc2FnZSwgYWN0aW9uKSB7CiAgICBsb2cuaSgibXJhaWQuZmlyZUVycm9yRXZlbnQgIiArIG1lc3NhZ2UgKyAiICIgKyBhY3Rpb24pOwogICAgZmlyZUV2ZW50KG1yYWlkLkVWRU5UUy5FUlJPUiwgbWVzc2FnZSwgYWN0aW9uKTsKICB9OwoKICBtcmFpZC5maXJlUmVhZHlFdmVudCA9IGZ1bmN0aW9uKCkgewogICAgbG9nLmkoIm1yYWlkLmZpcmVSZWFkeUV2ZW50Iik7CiAgICBmaXJlRXZlbnQobXJhaWQuRVZFTlRTLlJFQURZKTsKICB9OwoKICBtcmFpZC5maXJlU2l6ZUNoYW5nZUV2ZW50ID0gZnVuY3Rpb24od2lkdGgsIGhlaWdodCkgewogICAgbG9nLmkoIm1yYWlkLmZpcmVTaXplQ2hhbmdlRXZlbnQgIiArIHdpZHRoICsgIngiICsgaGVpZ2h0KTsKICAgIGlmIChzdGF0ZSAhPT0gbXJhaWQuU1RBVEVTLkxPQURJTkcpIHsKICAgICAgZmlyZUV2ZW50KG1yYWlkLkVWRU5UUy5TSVpFQ0hBTkdFLCB3aWR0aCwgaGVpZ2h0KTsKICAgIH0KICB9OwoKICBtcmFpZC5maXJlU3RhdGVDaGFuZ2VFdmVudCA9IGZ1bmN0aW9uKG5ld1N0YXRlKSB7CiAgICBsb2cuaSgibXJhaWQuZmlyZVN0YXRlQ2hhbmdlRXZlbnQgIiArIG5ld1N0YXRlKTsKICAgIGlmIChzdGF0ZSAhPT0gbmV3U3RhdGUpIHsKICAgICAgc3RhdGUgPSBuZXdTdGF0ZTsKICAgICAgZmlyZUV2ZW50KG1yYWlkLkVWRU5UUy5TVEFURUNIQU5HRSwgc3RhdGUpOwogICAgfQogIH07CgogIG1yYWlkLmZpcmVWaWV3YWJsZUNoYW5nZUV2ZW50ID0gZnVuY3Rpb24obmV3SXNWaWV3YWJsZSkgewogICAgbG9nLmkoIm1yYWlkLmZpcmVWaWV3YWJsZUNoYW5nZUV2ZW50ICIgKyBuZXdJc1ZpZXdhYmxlKTsKICAgIGlmIChpc1ZpZXdhYmxlICE9PSBuZXdJc1ZpZXdhYmxlKSB7CiAgICAgIGlzVmlld2FibGUgPSBuZXdJc1ZpZXdhYmxlOwogICAgICBmaXJlRXZlbnQobXJhaWQuRVZFTlRTLlZJRVdBQkxFQ0hBTkdFLCBpc1ZpZXdhYmxlKTsKICAgIH0KICB9OwoKICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICogaW50ZXJuYWwgaGVscGVyIG1ldGhvZHMKICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgogIGZ1bmN0aW9uIGNhbGxOYXRpdmUoY29tbWFuZCkgewogICAgdmFyIGlmcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIklGUkFNRSIpOwogICAgaWZyYW1lLnNldEF0dHJpYnV0ZSgic3JjIiwgIm1yYWlkOi8vIiArIGNvbW1hbmQpOwogICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmFwcGVuZENoaWxkKGlmcmFtZSk7CiAgICBpZnJhbWUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChpZnJhbWUpOwogICAgaWZyYW1lID0gbnVsbDsKICB9OwoKICBmdW5jdGlvbiBmaXJlRXZlbnQoZXZlbnQpIHsKICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTsKICAgIGFyZ3Muc2hpZnQoKTsKICAgIGxvZy5pKCJmaXJlRXZlbnQgIiArIGV2ZW50ICsgIiBbIiArIGFyZ3MudG9TdHJpbmcoKSArICJdIik7CiAgICB2YXIgZXZlbnRMaXN0ZW5lcnMgPSBsaXN0ZW5lcnNbZXZlbnRdOwogICAgaWYgKGV2ZW50TGlzdGVuZXJzKSB7CiAgICAgIHZhciBsZW4gPSBldmVudExpc3RlbmVycy5sZW5ndGg7CiAgICAgIGxvZy5pKGxlbiArICIgbGlzdGVuZXIocykgZm91bmQiKTsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgewogICAgICAgIGV2ZW50TGlzdGVuZXJzW2ldLmFwcGx5KG51bGwsIGFyZ3MpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBsb2cuaSgibm8gbGlzdGVuZXJzIGZvdW5kIGZvciAiICsgZXZlbnQpOwogICAgfQogIH07CgogIGZ1bmN0aW9uIGNvbnRhaW5zKHZhbHVlLCBhcnJheSkgewogICAgZm9yICggdmFyIGkgaW4gYXJyYXkpIHsKICAgICAgaWYgKGFycmF5W2ldID09PSB2YWx1ZSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZmFsc2U7CiAgfTsKCiAgLy8gVGhlIGFjdGlvbiBwYXJhbWV0ZXIgaXMgYSBzdHJpbmcgd2hpY2ggaXMgdGhlIG5hbWUgb2YgdGhlIHNldHRlciBmdW5jdGlvbgogIC8vIHdoaWNoIGNhbGxlZCB0aGlzIGZ1bmN0aW9uCiAgLy8gKGluIG90aGVyIHdvcmRzLCBzZXRFeHBhbmRQcm9wZXRpZXMsIHNldE9yaWVudGF0aW9uUHJvcGVydGllcywgb3IKICAvLyBzZXRSZXNpemVQcm9wZXJ0aWVzKS4KICAvLyBJdCBzZXJ2ZXMgYm90aCBhcyB0aGUga2V5IHRvIGdldCB0aGUgdGhlIGFwcHJvcHJpYXRlIHNldCBvZiB2YWxpZGF0aW5nCiAgLy8gZnVuY3Rpb25zIGZyb20gdGhlIGFsbFZhbGlkYXRvcnMgb2JqZWN0CiAgLy8gYXMgd2VsbCBhcyB0aGUgYWN0aW9uIHBhcmFtZXRlciBvZiBhbnkgZXJyb3IgZXZlbnQgdGhhdCBtYXkgYmUgdGhyb3duLgogIGZ1bmN0aW9uIHZhbGlkYXRlKHByb3BlcnRpZXMsIGFjdGlvbikgewogICAgdmFyIHJldHZhbCA9IHRydWU7CiAgICB2YXIgdmFsaWRhdG9ycyA9IGFsbFZhbGlkYXRvcnNbYWN0aW9uXTsKICAgIGZvciAodmFyIHByb3AgaW4gcHJvcGVydGllcykgewogICAgICB2YXIgdmFsaWRhdG9yID0gdmFsaWRhdG9yc1twcm9wXTsKICAgICAgdmFyIHZhbHVlID0gcHJvcGVydGllc1twcm9wXTsKICAgICAgaWYgKHZhbGlkYXRvciAmJiAhdmFsaWRhdG9yKHZhbHVlKSkgewogICAgICAgIG1yYWlkLmZpcmVFcnJvckV2ZW50KCJWYWx1ZSBvZiBwcm9wZXJ0eSAiICsgcHJvcCArICIgKCIgKyB2YWx1ZQkrICIpIGlzIGludmFsaWQiLCAibXJhaWQuIiArIGFjdGlvbik7CiAgICAgICAgcmV0dmFsID0gZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXR2YWw7CiAgfTsKCiAgdmFyIGFsbFZhbGlkYXRvcnMgPSB7CiAgICAic2V0RXhwYW5kUHJvcGVydGllcyIgOiB7CiAgICAgIC8vIEluIE1SQUlEIDIuMCwgdGhlIG9ubHkgcHJvcGVydHkgaW4gZXhwYW5kUHJvcGVydGllcyB3ZSBhY3R1YWxseSBjYXJlIGFib3V0IGlzIHVzZUN1c3RvbUNsb3NlLgogICAgICAvLyBTdGlsbCwgd2UnbGwgZG8gYSBiYXNpYyBzYW5pdHkgY2hlY2sgb24gdGhlIHdpZHRoIGFuZCBoZWlnaHQgcHJvcGVydGllcywgdG9vLgogICAgICAid2lkdGgiIDogZnVuY3Rpb24od2lkdGgpIHsKICAgICAgICByZXR1cm4gIWlzTmFOKHdpZHRoKTsKICAgICAgfSwKICAgICAgImhlaWdodCIgOiBmdW5jdGlvbihoZWlnaHQpIHsKICAgICAgICByZXR1cm4gIWlzTmFOKGhlaWdodCk7CiAgICAgIH0sCiAgICAgICJ1c2VDdXN0b21DbG9zZSIgOiBmdW5jdGlvbih1c2VDdXN0b21DbG9zZSkgewogICAgICAgIHJldHVybiAodHlwZW9mIHVzZUN1c3RvbUNsb3NlID09PSAiYm9vbGVhbiIpOwogICAgICB9CiAgICB9LAogICAgInNldE9yaWVudGF0aW9uUHJvcGVydGllcyIgOiB7CiAgICAgICJhbGxvd09yaWVudGF0aW9uQ2hhbmdlIiA6IGZ1bmN0aW9uKGFsbG93T3JpZW50YXRpb25DaGFuZ2UpIHsKICAgICAgICByZXR1cm4gKHR5cGVvZiBhbGxvd09yaWVudGF0aW9uQ2hhbmdlID09PSAiYm9vbGVhbiIpOwogICAgICB9LAogICAgICAiZm9yY2VPcmllbnRhdGlvbiIgOiBmdW5jdGlvbihmb3JjZU9yaWVudGF0aW9uKSB7CiAgICAgICAgdmFyIHZhbGlkVmFsdWVzID0gWyAicG9ydHJhaXQiLCAibGFuZHNjYXBlIiwgIm5vbmUiIF07CiAgICAgICAgcmV0dXJuICh0eXBlb2YgZm9yY2VPcmllbnRhdGlvbiA9PT0gInN0cmluZyIgJiYgdmFsaWRWYWx1ZXMuaW5kZXhPZihmb3JjZU9yaWVudGF0aW9uKSAhPT0gLTEpOwogICAgICB9CiAgICB9LAogICAgInNldFJlc2l6ZVByb3BlcnRpZXMiIDogewogICAgICAid2lkdGgiIDogZnVuY3Rpb24od2lkdGgpIHsKICAgICAgICByZXR1cm4gIWlzTmFOKHdpZHRoKSAmJiA1MCA8PSB3aWR0aDsKICAgICAgfSwKICAgICAgImhlaWdodCIgOiBmdW5jdGlvbihoZWlnaHQpIHsKICAgICAgICByZXR1cm4gIWlzTmFOKGhlaWdodCkgJiYgNTAgPD0gaGVpZ2h0OwogICAgICB9LAogICAgICAib2Zmc2V0WCIgOiBmdW5jdGlvbihvZmZzZXRYKSB7CiAgICAgICAgcmV0dXJuICFpc05hTihvZmZzZXRYKTsKICAgICAgfSwKICAgICAgIm9mZnNldFkiIDogZnVuY3Rpb24ob2Zmc2V0WSkgewogICAgICAgIHJldHVybiAhaXNOYU4ob2Zmc2V0WSk7CiAgICAgIH0sCiAgICAgICJjdXN0b21DbG9zZVBvc2l0aW9uIiA6IGZ1bmN0aW9uKGN1c3RvbUNsb3NlUG9zaXRpb24pIHsKICAgICAgICB2YXIgdmFsaWRQb3NpdGlvbnMgPSBbICJ0b3AtbGVmdCIsICJ0b3AtY2VudGVyIiwgInRvcC1yaWdodCIsCiAgICAgICAgICAiY2VudGVyIiwKICAgICAgICAgICJib3R0b20tbGVmdCIsICJib3R0b20tY2VudGVyIiwJImJvdHRvbS1yaWdodCIgXTsKICAgICAgICByZXR1cm4gKHR5cGVvZiBjdXN0b21DbG9zZVBvc2l0aW9uID09PSAic3RyaW5nIiAmJiB2YWxpZFBvc2l0aW9ucy5pbmRleE9mKGN1c3RvbUNsb3NlUG9zaXRpb24pICE9PSAtMSk7CiAgICAgIH0sCiAgICAgICJhbGxvd09mZnNjcmVlbiIgOiBmdW5jdGlvbihhbGxvd09mZnNjcmVlbikgewogICAgICAgIHJldHVybiAodHlwZW9mIGFsbG93T2Zmc2NyZWVuID09PSAiYm9vbGVhbiIpOwogICAgICB9CiAgICB9CiAgfTsKCiAgZnVuY3Rpb24gaXNDbG9zZVJlZ2lvbk9uU2NyZWVuKHByb3BlcnRpZXMpIHsKICAgIGxvZy5kKCJpc0Nsb3NlUmVnaW9uT25TY3JlZW4iKTsKICAgIGxvZy5kKCJkZWZhdWx0UG9zaXRpb24gIiArIGRlZmF1bHRQb3NpdGlvbi54ICsgIiAiICsgZGVmYXVsdFBvc2l0aW9uLnkpOwogICAgbG9nLmQoIm9mZnNldCAiICsgcHJvcGVydGllcy5vZmZzZXRYICsgIiAiICsgcHJvcGVydGllcy5vZmZzZXRZKTsKCiAgICB2YXIgcmVzaXplUmVjdCA9IHt9OwogICAgcmVzaXplUmVjdC54ID0gZGVmYXVsdFBvc2l0aW9uLnggKyBwcm9wZXJ0aWVzLm9mZnNldFg7CiAgICByZXNpemVSZWN0LnkgPSBkZWZhdWx0UG9zaXRpb24ueSArIHByb3BlcnRpZXMub2Zmc2V0WTsKICAgIHJlc2l6ZVJlY3Qud2lkdGggPSBwcm9wZXJ0aWVzLndpZHRoOwogICAgcmVzaXplUmVjdC5oZWlnaHQgPSBwcm9wZXJ0aWVzLmhlaWdodDsKICAgIHByaW50UmVjdCgicmVzaXplUmVjdCIsIHJlc2l6ZVJlY3QpOwoKICAgIHZhciBjdXN0b21DbG9zZVBvc2l0aW9uID0gcHJvcGVydGllcy5oYXNPd25Qcm9wZXJ0eSgiY3VzdG9tQ2xvc2VQb3NpdGlvbiIpID8KICAgICAgICBwcm9wZXJ0aWVzLmN1c3RvbUNsb3NlUG9zaXRpb24gOiByZXNpemVQcm9wZXJ0aWVzLmN1c3RvbUNsb3NlUG9zaXRpb247CiAgICBsb2cuZCgiY3VzdG9tQ2xvc2VQb3NpdGlvbiAiICsgY3VzdG9tQ2xvc2VQb3NpdGlvbik7CgogICAgdmFyIGNsb3NlUmVjdCA9IHsgIndpZHRoIjogNTAsICJoZWlnaHQiOiA1MCB9OwoKICAgIGlmIChjdXN0b21DbG9zZVBvc2l0aW9uLnNlYXJjaCgibGVmdCIpICE9PSAtMSkgewogICAgICBjbG9zZVJlY3QueCA9IHJlc2l6ZVJlY3QueDsKICAgIH0gZWxzZSBpZiAoY3VzdG9tQ2xvc2VQb3NpdGlvbi5zZWFyY2goImNlbnRlciIpICE9PSAtMSkgewogICAgICBjbG9zZVJlY3QueCA9IHJlc2l6ZVJlY3QueCArIChyZXNpemVSZWN0LndpZHRoIC8gMikgLSAyNTsKICAgIH0gZWxzZSBpZiAoY3VzdG9tQ2xvc2VQb3NpdGlvbi5zZWFyY2goInJpZ2h0IikgIT09IC0xKSB7CiAgICAgIGNsb3NlUmVjdC54ID0gcmVzaXplUmVjdC54ICsgcmVzaXplUmVjdC53aWR0aCAtIDUwOwogICAgfQoKICAgIGlmIChjdXN0b21DbG9zZVBvc2l0aW9uLnNlYXJjaCgidG9wIikgIT09IC0xKSB7CiAgICAgIGNsb3NlUmVjdC55ID0gcmVzaXplUmVjdC55OwogICAgfSBlbHNlIGlmIChjdXN0b21DbG9zZVBvc2l0aW9uID09PSAiY2VudGVyIikgewogICAgICBjbG9zZVJlY3QueSA9IHJlc2l6ZVJlY3QueSArIChyZXNpemVSZWN0LmhlaWdodCAvIDIpIC0gMjU7CiAgICB9IGVsc2UgaWYgKGN1c3RvbUNsb3NlUG9zaXRpb24uc2VhcmNoKCJib3R0b20iKSAhPT0gLTEpIHsKICAgICAgY2xvc2VSZWN0LnkgPSByZXNpemVSZWN0LnkgKyByZXNpemVSZWN0LmhlaWdodCAtIDUwOwogICAgfQoKICAgIHZhciBtYXhSZWN0ID0geyAieCI6IDAsICJ5IjogMCB9OwogICAgbWF4UmVjdC53aWR0aCA9IG1heFNpemUud2lkdGg7CiAgICBtYXhSZWN0LmhlaWdodCA9IG1heFNpemUuaGVpZ2h0OwoKICAgIHJldHVybiBpc1JlY3RDb250YWluZWQobWF4UmVjdCwgY2xvc2VSZWN0KTsKICB9CgogIGZ1bmN0aW9uIGZpdFJlc2l6ZVZpZXdPblNjcmVlbihwcm9wZXJ0aWVzKSB7CiAgICBsb2cuZCgiZml0UmVzaXplVmlld09uU2NyZWVuIik7CiAgICBsb2cuZCgiZGVmYXVsdFBvc2l0aW9uICIgKyBkZWZhdWx0UG9zaXRpb24ueCArICIgIiArIGRlZmF1bHRQb3NpdGlvbi55KTsKICAgIGxvZy5kKCJvZmZzZXQgIiArIHByb3BlcnRpZXMub2Zmc2V0WCArICIgIiArIHByb3BlcnRpZXMub2Zmc2V0WSk7CgogICAgdmFyIHJlc2l6ZVJlY3QgPSB7fTsKICAgIHJlc2l6ZVJlY3QueCA9IGRlZmF1bHRQb3NpdGlvbi54ICsgcHJvcGVydGllcy5vZmZzZXRYOwogICAgcmVzaXplUmVjdC55ID0gZGVmYXVsdFBvc2l0aW9uLnkgKyBwcm9wZXJ0aWVzLm9mZnNldFk7CiAgICByZXNpemVSZWN0LndpZHRoID0gcHJvcGVydGllcy53aWR0aDsKICAgIHJlc2l6ZVJlY3QuaGVpZ2h0ID0gcHJvcGVydGllcy5oZWlnaHQ7CiAgICBwcmludFJlY3QoInJlc2l6ZVJlY3QiLCByZXNpemVSZWN0KTsKCiAgICB2YXIgbWF4UmVjdCA9IHsgIngiOiAwLCAieSI6IDAgfTsKICAgIG1heFJlY3Qud2lkdGggPSBtYXhTaXplLndpZHRoOwogICAgbWF4UmVjdC5oZWlnaHQgPSBtYXhTaXplLmhlaWdodDsKCiAgICB2YXIgYWRqdXN0bWVudHMgPSB7ICJ4IjogMCwgInkiOiAwIH07CgogICAgaWYgKGlzUmVjdENvbnRhaW5lZChtYXhSZWN0LCByZXNpemVSZWN0KSkgewogICAgICBsb2cuZCgibm8gYWRqdXN0bWVudCBuZWNlc3NhcnkiKTsKICAgICAgcmV0dXJuIGFkanVzdG1lbnRzOwogICAgfQoKICAgIGlmIChyZXNpemVSZWN0LnggPCBtYXhSZWN0LngpIHsKICAgICAgYWRqdXN0bWVudHMueCA9IG1heFJlY3QueCAtIHJlc2l6ZVJlY3QueDsKICAgIH0gZWxzZSBpZiAoKHJlc2l6ZVJlY3QueCArIHJlc2l6ZVJlY3Qud2lkdGgpID4gKG1heFJlY3QueCArIG1heFJlY3Qud2lkdGgpKSB7CiAgICAgIGFkanVzdG1lbnRzLnggPSAobWF4UmVjdC54ICsgbWF4UmVjdC53aWR0aCkgLSAocmVzaXplUmVjdC54ICsgcmVzaXplUmVjdC53aWR0aCk7CiAgICB9CiAgICBsb2cuZCgiYWRqdXN0bWVudHMueCAiICsgYWRqdXN0bWVudHMueCk7CgogICAgaWYgKHJlc2l6ZVJlY3QueSA8IG1heFJlY3QueSkgewogICAgICBhZGp1c3RtZW50cy55ID0gbWF4UmVjdC55IC0gcmVzaXplUmVjdC55OwogICAgfSBlbHNlIGlmICgocmVzaXplUmVjdC55ICsgcmVzaXplUmVjdC5oZWlnaHQpID4gKG1heFJlY3QueSArIG1heFJlY3QuaGVpZ2h0KSkgewogICAgICBhZGp1c3RtZW50cy55ID0gKG1heFJlY3QueSArIG1heFJlY3QuaGVpZ2h0KSAtIChyZXNpemVSZWN0LnkgKyByZXNpemVSZWN0LmhlaWdodCk7CiAgICB9CiAgICBsb2cuZCgiYWRqdXN0bWVudHMueSAiICsgYWRqdXN0bWVudHMueSk7CgogICAgcmVzaXplUmVjdC54ID0gZGVmYXVsdFBvc2l0aW9uLnggKyBwcm9wZXJ0aWVzLm9mZnNldFggKyBhZGp1c3RtZW50cy54OwogICAgcmVzaXplUmVjdC55ID0gZGVmYXVsdFBvc2l0aW9uLnkgKyBwcm9wZXJ0aWVzLm9mZnNldFkgKyBhZGp1c3RtZW50cy55OwogICAgcHJpbnRSZWN0KCJhZGp1c3RlZCByZXNpemVSZWN0IiwgcmVzaXplUmVjdCk7CgogICAgcmV0dXJuIGFkanVzdG1lbnRzOwogIH0KCiAgZnVuY3Rpb24gaXNSZWN0Q29udGFpbmVkKGNvbnRhaW5pbmdSZWN0LCBjb250YWluZWRSZWN0KSB7CiAgICBsb2cuZCgiaXNSZWN0Q29udGFpbmVkIik7CiAgICBwcmludFJlY3QoImNvbnRhaW5pbmdSZWN0IiwgY29udGFpbmluZ1JlY3QpOwogICAgcHJpbnRSZWN0KCJjb250YWluZWRSZWN0IiwgY29udGFpbmVkUmVjdCk7CiAgICByZXR1cm4gKGNvbnRhaW5lZFJlY3QueCA+PSBjb250YWluaW5nUmVjdC54ICYmCiAgICAoY29udGFpbmVkUmVjdC54ICsgY29udGFpbmVkUmVjdC53aWR0aCkgPD0gKGNvbnRhaW5pbmdSZWN0LnggKyBjb250YWluaW5nUmVjdC53aWR0aCkgJiYKICAgIGNvbnRhaW5lZFJlY3QueSA+PSBjb250YWluaW5nUmVjdC55ICYmCiAgICAoY29udGFpbmVkUmVjdC55ICsgY29udGFpbmVkUmVjdC5oZWlnaHQpIDw9IChjb250YWluaW5nUmVjdC55ICsgY29udGFpbmluZ1JlY3QuaGVpZ2h0KSk7CiAgfQoKICBmdW5jdGlvbiBwcmludFJlY3QobGFiZWwsIHJlY3QpIHsKICAgIGxvZy5kKGxhYmVsICsKICAgICAgICAiIFsiICsgcmVjdC54ICsgIiwiICsgcmVjdC55ICsgIl0iICsKICAgICAgICAiLFsiICsgKHJlY3QueCArIHJlY3Qud2lkdGgpICsgIiwiICsgKHJlY3QueSArIHJlY3QuaGVpZ2h0KSArICJdIiArCiAgICAgICAgIiAoIiArIHJlY3Qud2lkdGggKyAieCIgKyByZWN0LmhlaWdodCArICIpIik7CiAgfQoKICBtcmFpZC5kdW1wTGlzdGVuZXJzID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgbkV2ZW50cyA9IE9iamVjdC5rZXlzKGxpc3RlbmVycykubGVuZ3RoOwogICAgbG9nLmkoImR1bXBpbmcgbGlzdGVuZXJzICgiICsgbkV2ZW50cyArICIgZXZlbnRzKSIpOwogICAgZm9yICggdmFyIGV2ZW50IGluIGxpc3RlbmVycykgewogICAgICB2YXIgZXZlbnRMaXN0ZW5lcnMgPSBsaXN0ZW5lcnNbZXZlbnRdOwogICAgICBsb2cuaSgiICAiICsgZXZlbnQgKyAiIGNvbnRhaW5zICIgKyBldmVudExpc3RlbmVycy5sZW5ndGggKyAiIGxpc3RlbmVycyIpOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGV2ZW50TGlzdGVuZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbG9nLmkoIiAgICAiICsgZXZlbnRMaXN0ZW5lcnNbaV0pOwogICAgICB9CiAgICB9CiAgfTsKCiAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAqIE1SQUlEIFZpZGVvIEFkZGVuZHVtCiAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKICB2YXIgdnBhaWQgPSB3aW5kb3cudnBhaWQgPSB7fTsKCiAgbXJhaWQuc2V0U3VwcG9ydHMoInZwYWlkIiwgdHJ1ZSk7CgogIHZwYWlkLmZpcmVFdmVudCA9IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICBsb2cuaSgidnBhaWQgZXZlbnQ6ICIgKyBldmVudCk7CiAgICBjYWxsTmF0aXZlKGV2ZW50KTsKICB9OwoKICB2cGFpZC5BZENsaWNrVGhydSA9IGZ1bmN0aW9uKHVybCwgaWQsIHBsYXllckhhbmRsZXMpIHsKICAgIGxvZy5pKCJ2cGFpZCBldmVudDogQWRDbGlja1RocnUgKCIgKyB1cmwgKyAiKSIpOwogICAgY2FsbE5hdGl2ZSgiQWRDbGlja1RocnU/dXJsPSIgKyBlbmNvZGVVUklDb21wb25lbnQodXJsKSk7CiAgfTsKCiAgdnBhaWQuQWRMb2cgPSBmdW5jdGlvbihzdHIpIHsKICAgIGxvZy5pKCJ2cGFpZCBldmVudDogQWRMb2cgKCIgKyBzdHIgKyAiKSIpOwogICAgY2FsbE5hdGl2ZSgiQWRMb2c/bXNnPSIgKyBzdHIpOwogIH07CgogIHZwYWlkLkFkRXJyb3IgPSBmdW5jdGlvbihzdHIpIHsKICAgIGxvZy5pKCJ2cGFpZCBldmVudDogQWRMb2cgKCIgKyBzdHIgKyAiKSIpOwogICAgY2FsbE5hdGl2ZSgiQWRFcnJvcj9tc2c9IiArIHN0cik7CiAgfTsKCiAgdnBhaWQuQWRTa2lwcGFibGVTdGF0ZUNoYW5nZSA9IGZ1bmN0aW9uKCkgewogICAgdmFyIHN0YXRlID0gdnBhaWQuY3JlYXRpdmUuZ2V0QWRTa2lwcGFibGVTdGF0ZSgpOwogICAgbG9nLmkoInZwYWlkIGV2ZW50OiBBZFNraXBwYWJsZVN0YXRlQ2hhbmdlICgiICsgc3RhdGUgKyAiKSIpOwogICAgY2FsbE5hdGl2ZSgiQWRTa2lwcGFibGVTdGF0ZUNoYW5nZT9zdGF0ZT0iICsgc3RhdGUpOwogIH07CgogIHZhciB2cGFpZENhbGxiYWNrcyA9IHsKICAgIEFkU3RhcnRlZCA6IHZwYWlkLmZpcmVFdmVudCwKICAgIEFkU3RvcHBlZCA6IHZwYWlkLmZpcmVFdmVudCwKICAgIEFkU2tpcHBlZCA6IHZwYWlkLmZpcmVFdmVudCwKICAgIEFkTG9hZGVkIDogdnBhaWQuZmlyZUV2ZW50LAogICAgQWRMaW5lYXJDaGFuZ2UgOiB2cGFpZC5maXJlRXZlbnQsCiAgICBBZFNpemVDaGFuZ2UgOiB2cGFpZC5maXJlRXZlbnQsCiAgICBBZEV4cGFuZGVkQ2hhbmdlIDogdnBhaWQuZmlyZUV2ZW50LAogICAgQWRTa2lwcGFibGVTdGF0ZUNoYW5nZSA6IHZwYWlkLkFkU2tpcHBhYmxlU3RhdGVDaGFuZ2UsCiAgICBBZER1cmF0aW9uQ2hhbmdlIDogdnBhaWQuZmlyZUV2ZW50LAogICAgQWRWb2x1bWVDaGFuZ2UgOiB2cGFpZC5maXJlRXZlbnQsCiAgICBBZEltcHJlc3Npb24gOiB2cGFpZC5maXJlRXZlbnQsCiAgICBBZENsaWNrVGhydSA6IHZwYWlkLkFkQ2xpY2tUaHJ1LAogICAgQWRJbnRlcmFjdGlvbiA6IHZwYWlkLmZpcmVFdmVudCwKICAgIEFkVmlkZW9TdGFydCA6IHZwYWlkLmZpcmVFdmVudCwKICAgIEFkVmlkZW9GaXJzdFF1YXJ0aWxlIDogdnBhaWQuZmlyZUV2ZW50LAogICAgQWRWaWRlb01pZHBvaW50IDogdnBhaWQuZmlyZUV2ZW50LAogICAgQWRWaWRlb1RoaXJkUXVhcnRpbGUgOiB2cGFpZC5maXJlRXZlbnQsCiAgICBBZFZpZGVvQ29tcGxldGUgOiB2cGFpZC5maXJlRXZlbnQsCiAgICBBZFVzZXJBY2NlcHRJbnZpdGF0aW9uIDogdnBhaWQuZmlyZUV2ZW50LAogICAgQWRVc2VyTWluaW1pemUgOiB2cGFpZC5maXJlRXZlbnQsCiAgICBBZFVzZXJDbG9zZSA6IHZwYWlkLmZpcmVFdmVudCwKICAgIEFkUGF1c2VkIDogdnBhaWQuZmlyZUV2ZW50LAogICAgQWRQbGF5aW5nIDogdnBhaWQuZmlyZUV2ZW50LAogICAgQWRFcnJvciA6IHZwYWlkLkFkRXJyb3IsCiAgICBBZExvZyA6IHZwYWlkLkFkTG9nCiAgfTsKCiAgbXJhaWQuaW5pdFZwYWlkID0gZnVuY3Rpb24odnBhaWRPYmplY3QpIHsKICAgIGlmKHR5cGVvZiB2cGFpZE9iamVjdCAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgdnBhaWQuY3JlYXRpdmUgPSB2cGFpZE9iamVjdDsKICAgICAgbG9nLmkoInZwYWlkIGluaXRWcGFpZCIpOwogICAgICBmb3IgKHZhciBldmVudE5hbWUgaW4gdnBhaWRDYWxsYmFja3MpIHsKICAgICAgICB2cGFpZE9iamVjdC5zdWJzY3JpYmUodnBhaWRDYWxsYmFja3NbZXZlbnROYW1lXSwgZXZlbnROYW1lKTsKICAgICAgfQogICAgICB2cGFpZE9iamVjdC5zdGFydEFkKCk7CiAgICB9CiAgfTsKCiAgbXJhaWQuRGVmYXVsdFZQQUlEQ3JlYXRpdmUgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgdmFyIHNraXBwYWJsZVN0YXRlID0gdHJ1ZTsKICAgIF90aGlzLnN1YnNjcmliZXMgPSB7fTsKCiAgICBfdGhpcy5nZXRBZFNraXBwYWJsZVN0YXRlID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBza2lwcGFibGVTdGF0ZTsKICAgIH07CgogICAgX3RoaXMuc2V0QWRTa2lwcGFibGVTdGF0ZSA9IGZ1bmN0aW9uKHN0YXRlKSB7CiAgICAgIHNraXBwYWJsZVN0YXRlID0gc3RhdGU7CiAgICB9OwoKICAgIF90aGlzLnN1YnNjcmliZSA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBldmVudE5hbWUpIHsKICAgICAgaWYgKCFfdGhpcy5zdWJzY3JpYmVzW2V2ZW50TmFtZV0pIHsKICAgICAgICBfdGhpcy5zdWJzY3JpYmVzW2V2ZW50TmFtZV0gPSBjYWxsYmFjazsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zb2xlLmxvZygiU3Vic2NyaXB0aW9uIGFscmVhZHkgc2V0Iik7CiAgICAgIH0KICAgIH07CgogICAgX3RoaXMudW5zdWJzY3JpYmUgPSBmdW5jdGlvbihldmVudE5hbWUpIHsKICAgICAgaWYgKF90aGlzLnN1YnNjcmliZXNbZXZlbnROYW1lXSkgewogICAgICAgIF90aGlzLnN1YnNjcmliZXNbZXZlbnROYW1lXSA9IG51bGw7CiAgICAgICAgZGVsZXRlIF90aGlzLnN1YnNjcmliZXNbZXZlbnROYW1lXTsKICAgICAgfSBlbHNlIHsKICAgICAgICBsb2cuaSgic3Vic2NyaXB0aW9uIG5vdCBzZXQiKTsKICAgICAgfQogICAgfTsKCiAgICBfdGhpcy5maXJlRXZlbnQgPSBmdW5jdGlvbihldmVudE5hbWUpIHsKICAgICAgaWYgKF90aGlzLnN1YnNjcmliZXNbZXZlbnROYW1lXSkgewogICAgICAgIHZhciBldmVudExpc3RlbmVyID0gX3RoaXMuc3Vic2NyaWJlc1tldmVudE5hbWVdOwogICAgICAgIGlmIChldmVudExpc3RlbmVyKSB7CiAgICAgICAgICB2YXIgYXJncyA9IFtldmVudE5hbWVdOwogICAgICAgICAgZXZlbnRMaXN0ZW5lci5hcHBseShudWxsLCBhcmdzKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbG9nLmkoIm5vIGxpc3RlbmVycyBmb3VuZCBmb3IgIiArIGV2ZW50TmFtZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9OwoKICAgIF90aGlzLnNlbmRMb2cgPSBmdW5jdGlvbihzdHIpIHsKICAgICAgZXZlbnROYW1lID0gIkFkTG9nIjsKICAgICAgaWYgKF90aGlzLnN1YnNjcmliZXNbZXZlbnROYW1lXSkgewogICAgICAgIHZhciBldmVudExpc3RlbmVyID0gX3RoaXMuc3Vic2NyaWJlc1tldmVudE5hbWVdOwogICAgICAgIGlmIChldmVudExpc3RlbmVyKSB7CiAgICAgICAgICB2YXIgYXJncyA9IFtzdHJdOwogICAgICAgICAgZXZlbnRMaXN0ZW5lci5hcHBseShudWxsLCBhcmdzKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbG9nLmkoIm5vIGxpc3RlbmVycyBmb3VuZCBmb3Igc2VuZExvZyIpOwogICAgICAgIH0KICAgICAgfQogICAgfTsKCiAgICBfdGhpcy5zZW5kRXJyb3IgPSBmdW5jdGlvbihzdHIpIHsKICAgICAgZXZlbnROYW1lID0gIkFkRXJyb3IiOwogICAgICBpZiAoX3RoaXMuc3Vic2NyaWJlc1tldmVudE5hbWVdKSB7CiAgICAgICAgdmFyIGV2ZW50TGlzdGVuZXIgPSBfdGhpcy5zdWJzY3JpYmVzW2V2ZW50TmFtZV07CiAgICAgICAgaWYgKGV2ZW50TGlzdGVuZXIpIHsKICAgICAgICAgIHZhciBhcmdzID0gW3N0cl07CiAgICAgICAgICBldmVudExpc3RlbmVyLmFwcGx5KG51bGwsIGFyZ3MpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBsb2cuaSgibm8gbGlzdGVuZXJzIGZvdW5kIGZvciBBZEVycm9yIik7CiAgICAgICAgfQogICAgICB9CiAgICB9OwoKICAgIF90aGlzLnNlbmRDbGljayA9IGZ1bmN0aW9uKHVybCkgewogICAgICBldmVudE5hbWUgPSAiQWRDbGlja1RocnUiOwogICAgICBpZiAoX3RoaXMuc3Vic2NyaWJlc1tldmVudE5hbWVdKSB7CiAgICAgICAgdmFyIGV2ZW50TGlzdGVuZXIgPSBfdGhpcy5zdWJzY3JpYmVzW2V2ZW50TmFtZV07CiAgICAgICAgaWYgKGV2ZW50TGlzdGVuZXIgJiYgdXJsKSB7CiAgICAgICAgICB2YXIgYXJncyA9IFt1cmxdOwogICAgICAgICAgZXZlbnRMaXN0ZW5lci5hcHBseShudWxsLCBhcmdzKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbG9nLmkoIm5vIGxpc3RlbmVycyBmb3VuZCBmb3IgQWRDbGlja1RocnUiKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9OwoKICBjb25zb2xlLmxvZygiTVJBSUQgb2JqZWN0IGxvYWRlZCIpOwoKfSkoKTs=";
}
